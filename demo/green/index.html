<!DOCTYPE html>
<meta charset='utf-8'>

<script>
    var _speedMark = new Date();
    function init_viewport()
    {
        if(/Android (\d+\.\d+)/.test(navigator.userAgent))
        {
            var version = parseFloat(RegExp.$1);

            if(version>2.3)
            {
                var width = window.outerWidth == 0 ? window.screen.width : window.outerWidth;
                var phoneScale = parseInt(width)/500;
                // if(phoneScale < 2)
                // {
                document.write('<meta name="viewport" content="width=500, minimum-scale = '+ phoneScale +', maximum-scale = '+ phoneScale +', target-densitydpi=device-dpi">');

                // }
                // else
                // {
                //     document.write('<meta name="viewport" content="target-densitydpi=320, width=500, min-height:850px, user-scalable=no"/>');
                // }
            }
            else
            {
                document.write('<meta name="viewport" content="width=500, target-densitydpi=device-dpi">');
            }
        }
        else if(navigator.userAgent.indexOf('iPhone') != -1)
        {
            var phoneScale = parseInt(window.screen.width)/500;
            document.write('<meta name="viewport" content="width=500; min-height=750;initial-scale=' + phoneScale +'; user-scalable=no;" /> ');         //0.75   0.82
        }
        else
        {
            document.write('<meta name="viewport" content="width=500, height=750, initial-scale=0.64" /> ');         //0.75   0.82

        }
    }
    init_viewport();
</script>

<script>
    document.ontouchmove = function(e)
    {
        e.preventDefault();
    }
</script>

<script src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>
<script>
    var module_inits = [];
    var upload_permission = true;
    var atkname = 'youmei';

    wx.config({
        debug     : false,
        appId     : 'wx849e56d54f7a2ef5',
        timestamp : 10000,
        nonceStr  : 'helloyoumei',
        signature : 'f068468a1e7c3dea5dca1c3bb8d66c4ab9e0c94c',
        jsApiList : [
            'onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareQZone', 'closeWindow', 'hideAllNonBaseMenuItem', 'showMenuItems', 'showAllNonBaseMenuItem', 'chooseImage', 'uploadImage']
    });

    function load_init_modules()
    {
        for(var i=0; i<module_inits.length; i++)
        {
            module_inits[i]();
        }
    }

    function call_me(fun)
    {
        module_inits.push(fun);
    }

    var ua = navigator.userAgent.toLowerCase();

    if(ua.match(/MicroMessenger/i) == 'micromessenger')
    {
        wx.ready(load_init_modules);
    }
    else
    {
        onload = load_init_modules;
    }
</script>

<script>
    var slider_images_url = [];slider_images_url.push('userImg/hn_445211448943.jpg');
    var date = 20161103;
    var zan_num = 0;
    var e_bookid = 'Fpx5HcVlzcptiKiQwQ9VHULpFle0vk3f';
    var e_desc = '深深的撒萨德撒多撒多所多撒多撒多撒大所多撒深深的撒萨德撒多撒';
    var e_openid = null;
    var e_scene = 'rose';
    var editmode = false;
    var wxid = 'haoyy';
    var shareid = '';
    var guanzhu_url = 'http://haoyy0.kagirl.cn/kphoto/more1.php?wxid=haoyy';
    var words = {};
    var app = '';
    e_openid = 'T_9RB8DEFShzyGSkhTLVbY3-f6SEc_PQEAFUoTWfJaU35DqqcCGofuNkU_Vx9Z13QOV1fV6lJlM';editmode = true; e_scene = 'faya';var e_music_url = '../music/menglishuixiang.mp3';
    var e_music_title = '';
    var tbssaveoff = false;
    var isguangchang = '';
</script>

<style type="text/css">

    .showwords
    {
        font-size: 28px;
        color: white;
        position: absolute;
        z-index: 1;
        top: 85%;
        margin: -39px;
        left: 39px;
        width: 100%;
        height: 35px;
        line-height: 35px;
        text-align: center;
        /*     background-color: rgba(255, 255, 255, 0.53);*/
        text-shadow: 3px 3px 10px black, -3px -3px 10px black, 3px -3px 10px black, -3px 3px 10px black;
        font-weight: bold;
        letter-spacing: 5px;
    }

    *
    {
        padding: 0px;
        margin: 0px;
        -webkit-box-sizing: border-box;
    }

    body
    {
        background-color: black;
    }

    #container
    {
        width: 500px;
        height: 100%;
        position: absolute;
        overflow: hidden;
    }
    #container > div,#container > img
    {
        position: absolute;
    }
    #ye1
    {
        left: -42px;
        top: -48px;
        -webkit-transform-origin: 25% 0%;
        -webkit-animation: yezi1 1.5s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ye2
    {
        left: 178px;
        top: -90px;
        -webkit-transform-origin: 50% 0%;
        -webkit-animation: yezi1 1.7s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ye3
    {
        left: 294px;
        top: -50px;
        -webkit-transform-origin: 50% 0%;
        -webkit-animation: yezi1 1.5s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ye4
    {
        -webkit-transform: scale(-1,1);
        -webkit-transform-origin: 25% 0%;
        left: 451px;
        top: -59px;
        -webkit-animation: yezi2 1.8s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ye5
    {
        left: -11px;
        top: -50px;
        -webkit-transform-origin: 50% 0%;
        -webkit-animation: yezi1 2s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ya
    {
        width: 97px;
        height: 179px;
        top: 546px;
        left: 354px;
        -webkit-transform-origin:100% 100%;
        -webkit-animation: yezi3 4s cubic-bezier(.27,0,.78,1) infinite alternate;
    }
    #ya > img
    {
        position: absolute;
    }
    #shuye1
    {
        left: -54px;
        top: 29px;
        -webkit-transform-origin: 96% 10%;
        -webkit-animation: yezi4 3s linear infinite alternate;
    }
    #shuye2
    {
        left: 3px;
        top: -77px;
        -webkit-transform-origin: 37% 100%;
        -webkit-animation: yezi1 3s linear infinite alternate;
    }
    #yedi
    {
        left: 0px;
        top: 680px;
    }
    #xing1
    {
        left: 453px;
        top: 705px;
        -webkit-animation: xing2 3s linear infinite;
    }
    #xing2
    {
        left: 228px;
        top: 699px;
        -webkit-animation: xing3 3s 2s linear infinite;
    }
    #xing3
    {
        left: 37px;
        top: 760px;
        -webkit-animation: xing4 3s 1s linear infinite;
    }
    #xing4
    {
        left: 373px;
        top: 568px;
        -webkit-animation: xing1 3s linear infinite;
    }
    #wenzi
    {
        width: 100px;
        height: 100px;
        left: 230px;
        top: 179px;
        position: absolute;
    }
    .chi1
    {
        left: 0px;
        top: 0px;
        position: absolute;
        -webkit-transform-origin: 89% 92%;
        -webkit-animation: chibang1 0.08s linear infinite alternate;

    }
    .chi2
    {
        left: 5px;
        top: 0px;
        position: absolute;
        -webkit-transform-origin: 89% 92%;
        -webkit-transform: scale(-1,1);
        -webkit-animation: chibang2 0.08s linear infinite alternate;

    }
    .tui1
    {
        left: 18px;
        top: 29px;
        position: absolute;
    }
    .tui2
    {
        left: 30px;
        top: 29px;
        position: absolute;
        -webkit-transform: scale(-1,1);
    }
    .yan
    {
        left: 19px;
        top: 22px;
        position: absolute;
    }
    .xian
    {
        position: absolute;
        left: 25px;
        top: 42px;
    }
    #wenzi1
    {
        position: absolute;
        left: -100px;
        top: 400px;
        -webkit-animation: wenzi1 15s linear infinite;
    }
    #wenzi1div
    {
        -webkit-animation: wenzi1div 15s linear infinite;
    }
    #wenzi2
    {
        position: absolute;
        left: 0px;
        top: 670px;
        -webkit-animation: wenzi1 18s 3s linear infinite;
    }
    #wenzi2div
    {
        left: 600px;
        -webkit-animation: wenzi2div 18s 3s linear infinite;;
    }
    #juxing
    {
        left: 209px;
        -webkit-transform: scale(2.5,-1);
        top: 243px;
        opacity: 0.5;
        position: absolute;
    }
    #titlemoving
    {
        position: absolute;
        -webkit-animation: titlemoving 1s linear infinite alternate;
    }
    #div1
    {
        border: 6px solid #fff;
        width: 460px;
        height: 300px;
        position: absolute;
        left: 20px;
        top: 220px;
        overflow: hidden;
    }
    #div2
    {
        border: 6px solid #fff;
        width: 380px;
        height: 600px;
        position: absolute;
        top: 100px;
        left: 60px;
        overflow: hidden;
    }

    .divimg
    {
        position: absolute;
        border: 6px solid #fff;
        overflow: hidden;
    }
    .divcon
    {
        width: 500px;
        height: 815px;
        position: absolute;
        opacity: 0;
        -webkit-transform-origin: 90% 20%;
    }
    .wenzi_1
    {
        position: absolute;
        left: 53px;
    }
    .wenzi_2
    {
        position: absolute;
        left: 390px;
    }

    #div1box
    {
        position: absolute;
        -webkit-animation: div1moving 1.5s ease-in-out infinite alternate;
    }
    #div2box
    {
        position: absolute;
        -webkit-animation: div2moving 1.5s ease-in-out infinite alternate;
    }
    #div3box
    {
        position: absolute;
        -webkit-animation: div1moving 1.5s ease-in-out infinite alternate;
    }
    #div4box
    {
        position: absolute;
        -webkit-animation: div1moving 1.5s ease-in-out infinite alternate;
    }
    #pagetitle
    {
        opacity: 0;
    }
</style>
<style type="text/css">
    @-webkit-keyframes yezi1
    {
        from  {-webkit-transform: rotate(0deg);}
        to    {-webkit-transform: rotate(3deg);}
    }
    @-webkit-keyframes yezi2
    {
        from  {-webkit-transform: rotate(0deg) scale(-1,1);}
        to    {-webkit-transform: rotate(-3deg) scale(-1,1);}
    }
    @-webkit-keyframes yezi3
    {
        from  {-webkit-transform: rotate(0deg) scale(0.7);}
        to    {-webkit-transform: rotate(5deg) scale(0.7);}
    }
    @-webkit-keyframes yezi4
    {
        from  {-webkit-transform: rotate(0deg);}
        to    {-webkit-transfrom: rotate(-3deg);}
    }
    @-webkit-keyframes xing1
    {
        0%   {-webkit-transform: rotate(0deg);opacity: 0}
        30%  {-webkit-transform: rotate(60deg);opacity: 1}
        60%  {-webkit-transform: rotate(120deg);opacity: 0}
        100% {opacity: 0}
    }
    @-webkit-keyframes xing2
    {
        0%   {opacity: 0;-webkit-transform: translate(0px,0px) rotate(60deg);}
        30%  {opacity: 1;-webkit-transform: translate(0px,-45px) rotate(42deg);}
        100% {opacity: 0;-webkit-transform: translate(0px,-150px) rotate(0deg);}
    }
    @-webkit-keyframes xing3
    {
        from  {opacity: 1;-webkit-transform: translate(0px,0px);}
        to    {opacity: 0;-webkit-transform: translate(0px,-100px);}
    }
    @-webkit-keyframes xing4
    {
        0%   {opacity: 0;-webkit-transform: translate(0px,0px) rotate(-60deg);}
        30%  {opacity: 1;-webkit-transform: translate(0px,-45px) rotate(-42deg);}
        100% {opacity: 0;-webkit-transform: translate(0px,-150px) rotate(0deg);}
    }
    @-webkit-keyframes chibang1
    {
        from  {-webkit-transform: rotate(0deg);}
        to    {-webkit-transform: rotate(-70deg);}
    }
    @-webkit-keyframes chibang2
    {
        from  {-webkit-transform: rotate(0deg) scale(-1,1);}
        to    {-webkit-transform: rotate(70deg) scale(-1,1);}
    }
    @-webkit-keyframes wenzi1
    {
        0%   {-webkit-transform: translate(0px,0px);-webkit-animation-timing-function: ease-out;}
        35%  {-webkit-transform: translate(420px,0px);-webkit-animation-timing-function: ease-in-out;}
        65%  {-webkit-transform: translate(200px,0px);-webkit-animation-timing-function: ease-in-out;}
        100% {-webkit-transform: translate(620px,0px);-webkit-animation-timing-function: ease-in;}
    }
    @-webkit-keyframes wenzi1div
    {
        0%   {-webkit-transform: translate(0px,0px);-webkit-animation-timing-function: ease-in-out;}
        50%  {-webkit-transform: translate(0px,-150px);-webkit-animation-timing-function: ease-in-out;}
        100% {-webkit-transform: translate(0px,-300px);-webkit-animation-timing-function: ease-in-out;}
    }
    @-webkit-keyframes wenzi2div
    {
        0%   {-webkit-transform: translate(0px,0px) scale(-1,1);-webkit-animation-timing-function: ease-in-out;}
        50%  {-webkit-transform: translate(0px,-150px) scale(-1,1);-webkit-animation-timing-function: ease-in-out;}
        100% {-webkit-transform: translate(0px,-300px) scale(-1,1);-webkit-animation-timing-function: ease-in-out;}
    }
    @-webkit-keyframes titlemoving
    {
        from  {-webkit-transform: translate(0px,0px);}
        to    {-webkit-transform: translate(0px,-10px);}
    }
    @-webkit-keyframes title_in
    {
        from  {opacity: 0;-webkit-transform: translate(0px,200px);}
        to    {opacity: 1;-webkit-transform: translate(0px,0px);}
    }
    @-webkit-keyframes title_out
    {
        from  {opacity: 1;-webkit-transform: translate(0px,0px);}
        to    {opacity: 0;-webkit-transform: translate(0px,-300px);}
    }
    @-webkit-keyframes div1_in
    {
        from  {-webkit-transform: translate(-400px,0px);opacity: 0}
        to    {-webkit-transform: translate(0px,0px);opacity: 1}
    }
    @-webkit-keyframes div1_out
    {
        from  {-webkit-transform: translate(0px,0px);opacity: 1}
        to    {-webkit-transform: translate(400px,0px);opacity: 0}
    }
    @-webkit-keyframes div1moving
    {
        from  {-webkit-transform: translate(-5px,0px);}
        to    {-webkit-transform: translate(5px,0px);}
    }
    @-webkit-keyframes div2moving
    {
        from  {-webkit-transform: translate(0px,-5px);}
        to    {-webkit-transform: translate(0px,5px);}
    }
    @-webkit-keyframes div2_in
    {
        from  {-webkit-transform: translate(0px,400px);opacity: 0}
        to    {-webkit-transform: translate(0px,0px);opacity: 1}
    }
    @-webkit-keyframes div2_out
    {
        from  {-webkit-transform: translate(0px,0px);opacity: 1}
        to    {-webkit-transform: translate(0px,-400px);opacity: 0}
    }
    @-webkit-keyframes div3_in
    {
        from  {-webkit-transform: translate(400px,0px);opacity: 0}
        to    {-webkit-transform: translate(0px,0px);opacity: 1}
    }
    @-webkit-keyframes div3_out
    {
        from  {-webkit-transform: translate(0px,0px);opacity: 1}
        to    {-webkit-transform: translate(-400px,0px);opacity: 0}
    }
    @-webkit-keyframes div4_in
    {
        from  {-webkit-transform: scale(0.3);opacity: 0}
        to    {-webkit-transform: scale(1);opacity: 1}
    }
    @-webkit-keyframes div4_out
    {
        from  {-webkit-transform: translate(0px,0px) scale(1);opacity: 1}
        to    {-webkit-transform: translate(-400px,400px) scale(1);opacity: 0}
    }

</style>

<div id='container'>
    <img src='img/bg1.jpg'>

    <img id='ye3' src='img/ye03.png'>
    <img id='ye5' src='img/ye03.png'>
    <img id='ye2' src='img/ye02.png'>
    <img id='ye1' src='img/ye01.png'>
    <img id='ye4' src='img/ye01.png'>


    <div id='pagetitle'>
        <div id='titlemoving'>
            <img id='juxing' src='img/juxing.png'>
            <div style='position: absolute;width: 212px;height: 238px;top: 262px;left: 149px;overflow: hidden;'>
                <div style='position:absolute;width:212px;height:238px;top:0px;left:0px;overflow:hidden;'>
                    <div style='position:absolute;width:212px;height:238px;display:table;overflow:hidden;'>
                        <div id='titlecontent' style='width:212px;height:238px;vertical-align:middle;display:table-cell;text-align:center;font-size:32px;line-height:45px;color:#3F6E08;font-weight:bold;'></div>
                    </div>
                </div>
            </div>

            <div id='wenzi'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>

        </div>
    </div>


    <div id='div1box'>
        <div id='div1con' class='divcon'>
            <div id='div1' class='divimg'>
                <img id='img1' style='position:absolute'>
                <span id='word1' class='showwords'>aaaaaaaaaa</span>
            </div>
            <div id='wenzi1_1' class='wenzi_1'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
            <div id='wenzi1_2' class='wenzi_2'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
        </div>
    </div>

    <div id='div2box'>
        <div id='div2con' class='divcon'>
            <div id='div2' class='divimg'>
                <img id='img2' style='position:absolute'>
                <span id='word2' class='showwords'></span>
            </div>
            <div id='wenzi2_1' class='wenzi_1'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
            <div id='wenzi2_2' class='wenzi_2'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
        </div>
    </div>

    <div id='div3box'>
        <div id='div3con' class='divcon'>
            <div id='div3' class='divimg'>
                <img id='img3' style='position:absolute'>
                <span id='word3' class='showwords'></span>
            </div>
            <div id='wenzi3_1' class='wenzi_1'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
            <div id='wenzi3_2' class='wenzi_2'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
        </div>
    </div>

    <div id='div4box'>
        <div id='div4con' class='divcon'>
            <div id='div4' class='divimg'>
                <img id='img4' style='position:absolute'>
                <span id='word4' class='showwords'></span>
            </div>
            <div id='wenzi4_1' class='wenzi_1'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
            <div id='wenzi4_2' class='wenzi_2'>
                <img src='img/chi.png' class='chi1'>
                <img src='img/chi.png' class='chi2'>
                <img src='img/yan.png' class='yan'>
                <img src='img/tui.png' class='tui1'>
                <img src='img/tui.png' class='tui2'>
                <img src='img/xian.png' class='xian'>
            </div>
        </div>
    </div>

    <div id='wenzi1div'>
        <div id='wenzi1'>
            <img src='img/chi.png' class='chi1'>
            <img src='img/chi.png' class='chi2'>
            <img src='img/yan.png' class='yan'>
        </div>
    </div>


    <div id='wenzi2div'>
        <div id='wenzi2'>
            <img src='img/chi.png' class='chi1'>
            <img src='img/chi.png' class='chi2'>
            <img src='img/yan.png' class='yan'>
        </div>
    </div>

    <div id='ya'>
        <img src='img/jing01.png'>
        <img id='shuye1' src='img/ye05.png'>
        <img id='shuye2' src='img/ye06.png'>
    </div>

    <img id='xing2' src='img/xingmang.png'>
    <img id='xing3' src='img/xingmang.png'>
    <img id='yedi' src='img/yedi.png'>

    <img id='xing1' src='img/xingmang.png'>
    <img id='xing4' src='img/xingmang.png'>

</div>



<script>

    var get_pid = function(url){
        var index1 = url.indexOf("?");
        if(index1 != -1)
        {
            url = url.substr(0, index1);
        }
        return url.toString().substr(url.lastIndexOf("/") + 1);
    }

    function id(name)
    {
        return document.getElementById(name)
    }

    function showtitle()
    {
        id('pagetitle').style.webkitAnimation = 'title_in 1.5s ease-out both';
        id('titlecontent').innerHTML = e_desc;
    }

    function distitle()
    {
        id('pagetitle').style.webkitAnimation = 'title_out 2.5s ease-in both';

        timeout1 = setTimeout(show1,2000)
    }

    function show1()
    {
        setImageindex();
        set_items_position('1');

        id('div1con').style.webkitAnimation = 'div1_in 2s ease-out both';

        timeout2 = setTimeout(show2,6000)
    }

    function show2()
    {
        setImageindex();
        set_items_position('2');

        id('div1con').style.webkitAnimation = 'div1_out 1.5s ease-in both'
        id('div2con').style.webkitAnimation = 'div2_in 2s ease-out 1s both';

        timeout3 = setTimeout(show3,6000)
    }

    function show3()
    {
        setImageindex();
        set_items_position('3');

        id('div2con').style.webkitAnimation = 'div2_out 1.5s ease-in both'
        id('div3con').style.webkitAnimation = 'div3_in 2s ease-out 1s both';

        timeout4 = setTimeout(show4,6000)
    }

    function show4()
    {
        setImageindex();
        set_items_position('4');

        id('div3con').style.webkitAnimation = 'div3_out 1.5s ease-in both'
        id('div4con').style.webkitAnimation = 'div4_in 2s ease-out 1s both';

        timeout5 = setTimeout(show1_1,6000)

    }

    function show1_1()
    {
        setImageindex();
        set_items_position('1');

        id('div4con').style.webkitAnimation = 'div4_out 1.5s ease-in both'
        id('div1con').style.webkitAnimation = 'div1_in 2s ease-out 1s both';

        timeout6 = setTimeout(show2,6000)
    }

    function insertEnter(str,n){
        var len = str.length;
        var strTemp = '';
        if(len > n){
            strTemp = str.substring(0,n);
            str = str.substring(n,len);
            return strTemp+'\n'+str;
        }else{
            return str;
        }
    }

    function set_items_position(pageid)
    {
        var img_bili = image_size_width[image_url_index]/image_size_height[image_url_index];

        console.log(img_bili);
        var div = id('div'+pageid);
        var img = id('img'+pageid);

        img.src = Onload_imgs_url[image_url_index];

        var word = id("word" + pageid);
        var word_string = words[get_pid(Onload_imgs_url[image_url_index])];
        if(word_string != undefined)

        {
            word_string = word_string.replace(/[\n]/ig,'');

            var word_length = word_string.length;
            if(word_length >= 5)
            {
                word.style.fontSize = "25px";
                if(word_length > 10)
                    word_string = insertEnter(word_string, 5);
            }else {
                word.style.fontSize = "28px";
            }
            word.innerText = word_string;
        }
        else
        {
            word.innerText = "";
        }

        if(img_bili >= 1)
        {
            id('wenzi'+pageid+'_1').style.top = '158px';
            id('wenzi'+pageid+'_2').style.top = '158px';


            div.style.width = '460px';
            if(img_bili > (460/300))
            {
                div.style.height = '300px';

                img.style.height = '300px';
                img.style.width = 300 * img_bili + 'px';
                img.style.left = (460 - 300 * img_bili)/2 + 'px';
                img.style.top = '0px';
            }
            else
            {
                div.style.height = 460 / img_bili + 'px';

                img.style.width = '460px';
                img.style.height = 460/img_bili+'px';
                img.style.left = '0px';
                img.style.top = '0px';
            }

            div.style.left = '20px';
            div.style.top = '220px';

        }
        else
        {
            id('wenzi'+pageid+'_1').style.top = '38px';
            id('wenzi'+pageid+'_2').style.top = '38px';

            div.style.width = '380px';
            if(img_bili < (380/600))
            {
                div.style.height = '600px';

                img.style.width = '380px';
                img.style.height = 380 / img_bili + 'px';
                img.style.left = '0px';
                img.style.top = (600-380/img_bili)/2 + 'px';
            }
            else
            {
                div.style.height = 380 / img_bili+ 'px';

                img.style.width = '380px';
                img.style.height = 380 / img_bili + 'px';
                img.style.left = '0px';
                img.style.top = '0px';
            }

            div.style.left = '60px';
            div.style.top = '100px';
        }

        image_url_index++;

    }


    call_me(load_images);
    var image_size_width=[];
    var image_size_height=[];
    var image_url_index=0;
    var have_num = 0;
    var error_num = 0;
    var canshow = true;
    var reshow = false;
    var delaytime=5000;

    var timeout0;
    var timeout1;
    var timeout2;
    var timeout3;
    var timeout4;
    var timeout5;
    var timeout6;

    function load_images()
    {
        reshow = false;
        image_size_width=[];
        image_size_height=[];
        Onload_imgs_url=[];
        image_url_index=0;
        have_num = 0;
        error_num = 0;
        begin_titletime = new Date();
        begin_titletime = begin_titletime.getTime();
        canshow = true;
        showtitle();

        bl_keepload = 'first';
        step_load();

    }
    //每次执行加载后5张图片
    var bl_keepload = 'first';
    var step_loadnum = 5;
    function step_load()
    {
        var load_num = 0
        //初步加载X张
        if(image_url_index  == 0 && bl_keepload == 'first')
        {
            console.log('loading continue');
            if(slider_images_url.length > step_loadnum)
            {
                load_num = step_loadnum;
                bl_keepload = 'next';
            }
            else
            {
                load_num = slider_images_url.length;
                bl_keepload = 'end';
            }
            for(var i = 0; i< load_num; i++)
            {
                var img=new Image();
                img.index=i;
                img.src=slider_images_url[i];
                img.onload=image_onload;
                img.onerror= image_onerror;
                Onload_imgs_url[i] = 'loading';
            }
        }
        else if(bl_keepload == 'end')
        {
            return;
        }
        else
        {
            console.log('loading continue');
            if(slider_images_url.length - image_url_index >step_loadnum*2)
            {
                load_num = step_loadnum;
            }
            else
            {
                load_num = slider_images_url.length - image_url_index - step_loadnum;
                bl_keepload = 'end';
            }
            for(var i = image_url_index +step_loadnum; i< image_url_index + step_loadnum + load_num; i++)
            {
                var img=new Image();
                img.index=i;
                img.src=slider_images_url[i];
                img.onload=image_onload;
                img.onerror= image_onerror;
                Onload_imgs_url[i] = 'loading';
            }
        }

    }
    function image_onerror(event)
    {
        var img = event.target;
        var index = img.index;
        if(index<step_loadnum)
            error_num ++;
        Onload_imgs_url[index] = 'not find';
        // console.log(Onload_imgs_url[index]);
        // console.log(have_num + '-' + error_num);
        if((have_num+error_num >= step_loadnum || slider_images_url.length == (have_num+error_num)) && canshow == true)
        {
            reshow = false;
            canshow =false;
            if(have_num == 0)
                return;
            var end_titletime = new Date();
            end_titletime = end_titletime.getTime();
            var dis_titletime = Math.abs(end_titletime-begin_titletime);
            if(dis_titletime>delaytime)
            {
                distitle();
            }
            else
            {
                dis_titletime = delaytime- dis_titletime;
                timeout0 = setTimeout(function()
                {
                    distitle();
                },dis_titletime);
            }
        }
    }

    function image_onload(event)
    {
        if(reshow == true)
            return;

        var img = event.target;
        var index = img.index;

        if(index<step_loadnum)
        {
            have_num++;
        }
        Onload_imgs_url[index] = img.src;
        image_size_height[index] = img.height;
        image_size_width[index] = img.width;

        console.log(Onload_imgs_url[index]);
        // console.log(have_num + '-' + error_num);

        if((have_num + error_num >= step_loadnum ||slider_images_url.length == (have_num+error_num)) && canshow == true)
        {
            reshow = false;
            canshow =false;
            if(have_num == 0)
                return;
            var end_titletime = new Date();
            end_titletime = end_titletime.getTime();
            var dis_titletime = Math.abs(end_titletime-begin_titletime);
            if(dis_titletime>delaytime)
            {
                distitle();
            }
            else
            {
                dis_titletime = delaytime- dis_titletime;
                timeout0 = setTimeout(function()
                {
                    distitle();
                },dis_titletime);
            }

        }

    }
    function setImageindex()
    {
        if(image_url_index == Onload_imgs_url.length)
            image_url_index = 0;

        while(Onload_imgs_url[image_url_index] == 'not find' || Onload_imgs_url[image_url_index] == 'loading')
        {
            // console.log('setimg:' + Onload_imgs_url[image_url_index]);
            if(image_url_index % step_loadnum == 0)
            {
                step_load();
            }
            image_url_index++;
            if(image_url_index == Onload_imgs_url.length)
                image_url_index = 0;
        }



        console.log('setimg:' + Onload_imgs_url[image_url_index]);
        if(image_url_index % step_loadnum == 0)
        {
            step_load();
        }

    }

    function reload_scene()
    {
        clearnode();
        reshow = true;
        setTimeout(load_images,100);
    }

    function clearnode()
    {
        id('div1con').style.webkitAnimation = '';
        id('div2con').style.webkitAnimation = '';
        id('div3con').style.webkitAnimation = '';
        id('div4con').style.webkitAnimation = '';
        id('pagetitle').style.webkitAnimation = '';

        clearTimeout(timeout0);
        clearTimeout(timeout1);
        clearTimeout(timeout2);
        clearTimeout(timeout3);
        clearTimeout(timeout4);
        clearTimeout(timeout5);
        clearTimeout(timeout6);

    }
</script>


<link type="text/css" rel="stylesheet" href="css/guanzhu.css?ver=3" />
<link rel="stylesheet" type="text/css" href="css/buttons.css" />
<meta name="copyright" content="我司的相册模板为版权所有，请停止抄袭，否则将按照侵权起诉！">
<style type="text/css">
    @-webkit-keyframes zhuan
    {
        0%
        {
            -webkit-transform:rotate(0deg);
        }

        100%
        {
            -webkit-transform:rotate(360deg);
        }
    }


    @-webkit-keyframes aa_out_bounce_left
    {
        0%{
            -webkit-transform:translateX(0)
        }
        20%{
            -webkit-transform:translateX(20px)
        }
        100%{
            -webkit-transform:translateX(-125px)
        }
    }
    @-webkit-keyframes aa_in_bounce_center
    {
        0%{
            opacity:0;
            -webkit-transform:scale(.3)
        }
        50%{
            opacity:1;
            -webkit-transform:scale(1.05)
        }
        70%{
            -webkit-transform:scale(.9)
        }
        100%{
            -webkit-transform:scale(1)
        }
    }
    @-webkit-keyframes jinbi
    {
        from {-webkit-transform: rotateY(0deg);}
        to   {-webkit-transform: rotateY(180deg);}
    }
    .jubao-item
    {
        position: relative;
        float: left;
        width: 360px;
        height: 55px;
        top: 0px;
        font-size: 20px;
        line-height: 55px;
        margin-left: 20px;
        border-bottom: 1px solid #EBEBEB;
    }
    .jubao-radio
    {
        position: absolute;
        right: 10px;
        width: 25px;
        height: 25px;
        top: 20px;
    }

    .jubao-detail
    {
        position: relative;
        float: left;
        width: 360px;
        margin-left: 20px;
    }
    .jubao-detail textarea
    {
        width: 360px;
        height: 80px;
        font-size: 20px;
        resize: none;
        line-height: 40px;
        border: none;
        background-color: #eee;
        border-radius: 10px;
        padding-left: 10px;
    }
    @-webkit-keyframes guangzhu_ani
    {
        from  {-webkit-transform: scale(1.1);opacity: 1}
        to    {-webkit-transform: scale(1.2);opacity: 1}
    }
    @-webkit-keyframes che_ani
    {
        0%    {-webkit-transform: translate(-20px,0px);opacity: 1}
        8%  {-webkit-transform: translate(100px,0px) scale(0.95,1.05);opacity: 1}
        10%  {-webkit-transform: translate(100px,0px) scale(1,1);opacity: 1}
        12%   {-webkit-transform: translate(100px,0px); opacity: 1}
        14%   {-webkit-transform: translate(100px,0px); opacity: 1}
        16%   {-webkit-transform: translate(100px,0px); opacity: 1}
        18%   {-webkit-transform: translate(100px,0px); opacity: 1}
        20%   {-webkit-transform: translate(100px,0px); opacity: 1}
        45%   {-webkit-transform: translate(100px,0px) scale(0.97,1.03); opacity: 1}
        50%   {-webkit-transform: translate(100px,0px); opacity: 1}
        60%   {-webkit-transform: translate(200px,0px); opacity: 0}
        100%  {-webkit-transform: translate(200px,0px); opacity: 0}
    }
    @-webkit-keyframes che1_ani
    {
        0%    {opacity: 1}
        12%   {opacity: 1}
        14%   {opacity: 0.5}
        16%   {opacity: 1}
        18%   {opacity: 0.5}
        20%   {opacity: 1}
        100%  {opacity: 1}

    }
    @-webkit-keyframes baoming
    {
        0%  {opacity: 0}
        58% {opacity: 0;-webkit-transform: scale(1.4);}
        59% {opacity: 1;-webkit-transform: scale(1.4);}
        70% {opacity: 1;-webkit-transform: scale(0.95);}
        72% {opacity: 1;-webkit-transform: scale(1);}
        80% {opacity: 0.8;-webkit-transform: scale(1.1);}
        88% {opacity: 1;-webkit-transform: scale(1);}
        93% {opacity: 0;-webkit-transform: scale(1.3);}
        100%{opacity: 0}
    }
    @-webkit-keyframes shijia
    {
        0%  {-webkit-transform: rotate(20deg) scale(0.8);opacity: 0}
        10% {-webkit-transform: rotate(20deg) scale(0.75);opacity: 1}
        20% {-webkit-transform: rotate(20deg) scale(0.85);}
        28% {-webkit-transform: rotate(20deg) scale(0.75);}
        38% {-webkit-transform: rotate(20deg) scale(0.85);}
        47% {-webkit-transform: rotate(20deg) scale(0.75);opacity: 1}
        55% {-webkit-transform: rotate(20deg) scale(0.90);opacity: 0}
        100%{opacity: 0}

    }
    @-webkit-keyframes biaozhi_ani
    {
        0%  {opacity: 0}
        10% {opacity: 0}
        20% {opacity: 1}
        45% {opacity: 1}
        55% {opacity: 0}
        100%{opacity: 0}
    }
    #musicinfo
    {
        color: #fff;
        text-shadow: 1px 1px 2px #000;
        font-size: 15px;
        position: fixed;
        left: 432px;
        top: 82px;
        width: 60px;
        height: 20px;
        z-index: 100;
        display: none;
        opacity: 1;
    }
    @-webkit-keyframes heart_beating
    {
        from {opacity: 1;-webkit-transform: scale(1);}
        to   {opacity: 0.8;-webkit-transform: scale(0.8);}
    }
    @-webkit-keyframes heart1_moving
    {
        from  {opacity: 1;-webkit-transform: translate(0px,0px) scale(1);}
        to    {opacity: 0;-webkit-transform: translate(-20px,-50px) scale(1.5);}
    }
    @-webkit-keyframes heart2_moving
    {
        from  {opacity: 1;-webkit-transform: translate(0px,0px) scale(1);}
        to    {opacity: 0;-webkit-transform: translate(20px,-60px) scale(2);}
    }
    @-webkit-keyframes heart3_moving
    {
        from  {opacity: 1;-webkit-transform: translate(0px,0px) scale(1);}
        to    {opacity: 0;-webkit-transform: translate(70px,-40px) scale(2);}
    }
    #enddiv
    {
        position: absolute;
        width: 500px;
        height: 815px;
        background-color: rgba(0,0,0,0.7);
        z-index: 10000;
        display: none;
        opacity: 0;
    }
    #title_div
    {
        width: 320px;
        height: 200px;
        left: 90px;
        top: 250px;
        color: #fff;
        font-size: 25px;
        position: relative;
        line-height: 45px;
        text-align: center;
        font-family: '微软雅黑';
        display:table;
    }
    #title_line
    {
        position: absolute;
        width: 370px;
        height: 2px;
        background-color: #fff;
        top: 415px;
        left: 65px;
    }
    #reshowbtn
    {
        position: absolute;
        width: 150px;
        height: 44px;
        border-radius: 10px;
        background-color: rgba(94,159,177,0.9);
        color: #fff;
        font-size: 22px;
        text-align: center;
        line-height: 44px;
        top: 446px;
        left: 74px;
    }
    #guanzhubtn
    {
        position: absolute;
        width: 150px;
        height: 44px;
        border-radius: 10px;
        background-color: rgba(185,91,83,0.9);
        color: #fff;
        font-size: 22px;
        text-align: center;
        line-height: 44px;
        top: 446px;
        left: 268px;
    }
    #morexiangce
    {
        position: fixed;
        width: 240px;
        height: 50px;
        background-color: rgba(0,0,0,0.5);
        color: white;
        text-align: center;
        border-radius: 25px;
        bottom: 20px;
        left: 130px;
        padding: 0px;
        margin: 0px;
        -webkit-box-sizing: border-box;
        font-size: 24px;
        padding-top: 11px;
        z-index: 9999;
        line-height: 28px;
        border: 1px solid #fff;
        display: none;
    }
    #saveoff,#savepic
    {
        position: fixed;
        width: 100px;
        height: 50px;
        background-color: rgba(0,0,0,0.5);
        color: white;
        text-align: center;
        border-radius: 25px;
        bottom: 20px;
        left: 10px;
        padding: 0px;
        margin: 0px;
        font-size: 14pt;
        z-index: 9999;
        line-height: 50px;
        border: 1px solid #fff;
        display: none;
    }
    @-webkit-keyframes fadein
    {
        from  {opacity: 0}
        to    {opacity: 1}
    }
    @-webkit-keyframes fadeout
    {
        from  {opacity: 1}
        to    {opacity: 0}
    }
    #loadingdiv
    {
        width: 500px;
        height: 815px;
        z-index: 20000;
        background-color: rgba(255,255,255,0.5);
        position: absolute;
        pointer-events: none;
    }
    .loadingword
    {
        font-size: 25px;
        color: rgba(82,82,82,0.9);
        font-family: '微软雅黑';
        text-align: center;
        width: 500px;
        position: relative;
        top: 300px;
        line-height: 50px;
    }
    .gspan1
    {
        -webkit-animation: spanmove 3s linear infinite;
        position: absolute;
        left: 50px;
    }
    .gspan2
    {
        -webkit-animation: spanmove 3s 0.6s linear infinite;
        position: absolute;
        left: 75px;
    }
    .gspan3
    {
        -webkit-animation: spanmove 3s 1.2s linear infinite;
        position: absolute;
        left: 100px;
    }
    .gspan4
    {
        -webkit-animation: spanmove 3s 1.8s linear infinite;
        position: absolute;
        left: 125px;
    }
    .gspan5
    {
        -webkit-animation: spanmove 3s 2.4s linear infinite;
        position: absolute;
        left: 150px;
    }
    @-webkit-keyframes spanmove
    {
        0%   {-webkit-transform: scale(1);}
        10%  {-webkit-transform: scale(1.5);}
        20%  {-webkit-transform: scale(1);}
        100% {-webkit-transform: scale(1);}
    }
    #letter
    {
        /*position: fixed;*/
        /*	left: 25px;
	bottom: 30px;*/
        width: 120px;
        height: 80px;
        /*-webkit-animation: lettermove 2s linear infinite alternate;*/
        z-index: 10000;
        position: absolute;
        top: 0px;
    }
    #letterpicdiv
    {
        /*	position: fixed;
	left: 25px;
	bottom: 30px;
	width: 120px;
	height: 80px;
	-webkit-animation: lettermove 2s linear infinite alternate;
	z-index: 10000;	
	display: none;*/
        position: fixed;
        left: -19px;
        bottom: -12px;
        width: 120px;
        height: 80px;
        z-index: 10000;
        -webkit-transform: scale(0.6);
        display: none;
    }
    @-webkit-keyframes lettermove
    {
        from  {-webkit-transform: rotate(15deg) scale(0.8);}
        to    {-webkit-transform: rotate(-15deg) scale(0.8);}
    }
    #letterdiv
    {
        width: 500px;
        position: absolute;
        height: 815px;
        background-color: rgba(0,0,0,0.7);
        z-index: 10001;
        display: none;
    }
    .lettercon
    {
        width: 350px;
        height: 450px;
        background-color: #fff;
        left: 75px;
        top: 150px;
        position: absolute;
    }
    .lettertitle
    {
        width: 100%;
        height: 45px;
        background-color: #F44336;
        color: #fff;
        font-size: 25px;
        text-align: center;
        line-height: 45px;
    }
    .lettercontent
    {
        width: 310px;
        margin-top: 15px;
        margin-left: 20px;
        font-size: 22px;
        line-height: 35px;
        text-align: center;
    }
    .letterimg
    {
        width: 150px;
        text-align: center;

        /*margin-left: 75px;*/
    }
    #lettername
    {
        width: 100%;
        font-size: 18px;
        text-align: right;
        margin-top: 10px;
    }
    .newxiangce
    {
        width: 250px;
        height: 50px;
        background-color: #F44336;
        border-radius: 10px;
        margin-top: 10px;
        color: #fff;
        margin-left: 50px;
        font-size: 24px;
        line-height: 50px;
        text-align: center;
        -webkit-animation: guangzhu_ani 0.7s linear infinite alternate;
        position: absolute;
        bottom: 20px;
    }
    a
    {
        text-decoration: none;
    }
    .letterclose
    {
        font-size: 40px;
        width: 50px;
        height: 50px;
        position: absolute;
        left: 305px;
        top: 0px;
        color: #fff;
        line-height: 45px;

    }
    #letternotice
    {
        position: absolute;
        width: 30px;
        height: 30px;
        background-color: #ff0000;
        border-radius: 15px;
        left: 103px;
        top: -10px;
        z-index: 10000;
        color: #fff;
        font-size: 22px;
        text-align: center;
        line-height: 30px;
        font-weight: bold;
        display: none;
    }

    @-webkit-keyframes guanzhu_test
    {
        0%    {-webkit-transform: translate(-400px,0px) scale(1.1);opacity: 1}
        10%   {-webkit-transform: translate(0px,0px) scale(1.1);opacity: 1}
        20%   {-webkit-transform: translate(0px,0px) scale(1.15);opacity: 1}
        30%   {-webkit-transform: translate(0px,0px) scale(1.1);opacity: 1}
        40%   {-webkit-transform: translate(0px,0px) scale(1.15);opacity: 1}
        50%   {-webkit-transform: translate(0px,0px) scale(1.1);opacity: 1}
        60%   {-webkit-transform: translate(0px,0px) scale(1.15);opacity: 1}
        70%   {-webkit-transform: translate(0px,0px) scale(1.1);opacity: 1}
        80%   {-webkit-transform: translate(0px,0px) scale(1.15);opacity: 1}
        90%   {-webkit-transform: translate(0px,0px) scale(1.1);opacity: 1}
        94%   {-webkit-transform: translate(0px,0px) scale(1.2);opacity: 1}
        100%  {-webkit-transform: translate(0px,0px) scale(0.5);opacity: 0}
    }
    /*#savepic
{
	position: fixed;
    width: 90px;
    height: 50px;
    background-color: rgba(0,0,0,0.5);
    color: white;
    text-align: center;
    bottom: 20px;
    left: 0px;
    padding: 0px;
    margin: 0px;
    font-size: 14pt;
    z-index: 9999;
    line-height: 50px;
    border: 1px solid #fff;
    border-top-right-radius: 25px;
    border-bottom-right-radius: 25px;
    display: none;
}*/
</style>
<script type="text/javascript" src="js/xmlHttp.js"></script>
<script type="text/javascript">

    if(typeof(objid) === "undefined")
    {
        var objid = function(id)
        {
            return document.getElementById(id);
        }
    }

    function random(min,max)
    {
        return Math.floor(min+Math.random()*(max-min));
    }

    function share_url()
    {

        // if(editmode == false && (wxid == 'xinqing' || wxid == 'mofa' || wxid == 'youpin' || wxid == 'youmei' || wxid == 'xingfu' || wxid == 'sjyy' || wxid == 'keji' || wxid == 'youran' || wxid == 'donggan' || wxid == 'dongtai') )
        // {
        // objid('guanzhu_container').style.display = 'block';
        // }

        var locationurl = window.location.href;
        if(locationurl.indexOf('hidden')!=-1)
        {
            objid('guanzhu_container').style.display = 'none';
        }

        if(locationurl.indexOf('noshow')!=-1)
        {
            objid('guanzhu_container').style.display = 'none';
        }

        if(locationurl.indexOf('more=true')!=-1)
        {
            objid('morexiangce').style.display = 'block';
            if(!tbssaveoff)
            {
                objid('savepic').style.display = 'block';
            }
        }

        var index = random(0, 5);
        index = index>=5?4:index;
        // var index = 0;

        // if(((e_bookid == 'KPFArkq_BczWB-JZomFBnzTU-XRIgcos' && wxid == 'chuanqi') || (e_bookid == 'dD2nhG888UwtloewAuQhNpNkAKLhhjMbPVmwpJ5UxaM' && wxid == 'kawa') ) && editmode == false && e_scene == 'qian')
        // 	objid('fudai').style.display = 'block';


        // if(wxid == 'youyi' || shareid == 'youyi')
        // {
        // 	return "http://"+wxid+index+".kawabody.cn/kphoto/doubleshowbook.php?bookid=" + e_bookid + "&wxid=" + wxid + '&shareid=' + shareid;
        // }

        if((wxid == 'xinqing' || wxid == 'liti' || wxid == 'dongtai'  || wxid == 'shiguang' || wxid == 'xuanmei' || wxid == 'zuimei' || wxid == 'chuangyi' || wxid == 'jingdian' || wxid == 'huoli' || wxid == 'quwei' || wxid == 'guangying' || wxid == 'qingling' || wxid == 'yywm' || wxid == 'kuaiyi' )&& locationurl.indexOf('showid')!=-1)
        {
            return "http://"+wxid+index+".kagirl.cn/kphoto/doublebook.php?showid="+wxid+"&bookid=" + e_bookid + "&wxid=" + wxid + '&shareid=' + shareid;
        }
        if(shareid == "xuandong" && location.href.indexOf("app=xdxj") != -1)
        {
            return "http://"+wxid+index+".kagirl.cn/kphoto/doublebook.php?bookid=" + e_bookid + "&wxid=" + wxid + '&shareid=' + shareid + "&app=xdxj";
        }

        return "http://"+wxid+index+".kagirl.cn/kphoto/doublebook.php?bookid=" + e_bookid + "&wxid=" + wxid + '&shareid=' + shareid;

    }

    function share_img()
    {
        var url = slider_images_url[0];
        var index = url.indexOf("?");
        if(index != -1)
        {
            return url.substr(0, index);
        }
        return url;
    }

    function on_weixin_share()
    {
        if(!wx)
        {
            return;
        }
        try{
            wx.hideAllNonBaseMenuItem();
            wx.showMenuItems({
                menuList: ["menuItem:share:appMessage", "menuItem:share:timeline", "menuItem:share:qq", "menuItem:share:QZone", "menuItem:favorite", "menuItem:profile", "menuItem:addContact", "menuItem:refresh", "menuItem:copyUrl"] // 要显示的菜单项，所有menu项见附录3
            });
            var desc = e_desc.replace("<br>", "\n").replace("<br/>", "\n");
            wx.onMenuShareAppMessage({
                title   : '音乐相册',
                desc    : desc,
                link    : share_url(),
                imgUrl  : share_img(),
                type    : 'link',
                success: function () {
                    share_callback('message');
                },
                cancel: function () {
                }
            });

            wx.onMenuShareTimeline({
                title  : desc,
                link   : share_url(),
                imgUrl : share_img(),
                success: function () {
                    share_callback('timeline');
                },
                cancel: function () {
                }
            });
            wx.onMenuShareQQ({
                title   : '音乐相册',
                desc    : desc,
                link    : share_url(),
                imgUrl  : share_img(),
                type    : 'link',
                success: function () {
                    share_callback('message');
                },
                cancel: function () {
                }
            });
            wx.onMenuShareQZone({
                title   : '音乐相册',
                desc    : desc,
                link    : share_url(),
                imgUrl  : share_img(),
                type    : 'link',
                success: function () {
                    share_callback('message');
                },
                cancel: function () {
                }
            });
        }
        catch(e){

        }
    }

    function share_callback(type)
    {
        if(editmode == false)
        {
            XMLHttp.sendReq('GET', 'adpv.php?click=8', '', function(){})
        }
        else
        {

            XMLHttp.sendReq('GET', 'tongjiscene.php?scene='+e_scene+'&type=edit', '', function(){});
            // XMLHttp.sendReq('GET', 'adpv.php?click=9', '', function(){})
            try{

                if(tbssaveoff)
                {
                    XMLHttp.sendReq('GET', 'adpv.php?click=saveshare', '', function(){
                    });
                }
                else{
                    XMLHttp.sendReq('GET', 'adpv.php?click=nosaveshare', '', function(){
                    });
                }
            }catch(e){
            }
        }
        var url = "editbook.php?type=" + type + "&bookid=" + e_bookid + "&wxid=" + wxid + "&shareid=" + shareid;

        if(e_openid != null)
        {
            url = url + '&openid=' + e_openid;
        }

        url = url + "&desc=" + encodeURIComponent(e_desc);

        if(e_music_url !== "")
        {
            url = url + "&music=" + encodeURIComponent(e_music_url);
        }

        url = url + "&scene=" +e_scene;

        if(shareid == "xuandong" && location.href.indexOf("app=xdxj") != -1)
        {
            location.href = "https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MzIyNzA4NDU1Ng==#wechat_webview_type=1&wechat_redirect";
            return;
        }

        if(editmode == true)
        {
            var print_scenes = {
                "lovetrip" : 1,
                "xiangyin" : 1,
                "baby" : 1,
                "naxienian" : 1,
                "minion" : 1,
                "maxituan" : 1,
                "qingchun" : 1,
                "shengri" : 1,
                "shatan" : 1,
                "summer" : 1
            }
            if(wxid == 'lzy' && print_scenes[e_scene] && slider_images_url.length >= 12)
            {
                XMLHttp.sendReq('GET',url, '', function(){});
                location.href = 'printinfo.php?wxid='+wxid+'&bookid='+e_bookid+'&openid='+e_openid+'&scene='+e_scene;
            }
            else if((wxid == 'lzy') && (e_scene == 'naxienian' || e_scene == 'shengri') && slider_images_url.length>21)
            {
                XMLHttp.sendReq('GET',url, '', function(){});
                location.href = 'http://nap.naturalgift.cc/nap/doc/print/buttons.php?wxid='+wxid+'&bookid='+e_bookid+'&openid='+e_openid+'&scene='+e_scene;
            }
            else
                location.href = url;

        }

        else
        {
            if(editmode == false && objid('guanzhu_container').style.display != 'none')
            {
                XMLHttp.sendReq('GET', url, '', function(){});
                if(shareid == '')
                    location.href = 'http://'+wxid+'0.kagirl.cn/kphoto/more1.php?show=true&wxid='+wxid + "&openid=" + e_openid;
                else
                    location.href = 'http://'+wxid+'0.kagirl.cn/kphoto/more1.php?show=true&wxid='+shareid + "&openid=" + e_openid;
            }
            else
            {
                XMLHttp.sendReq('GET', url, '', function(){});
                if(shareid == '')
                    location.href = 'http://'+wxid+'0.kagirl.cn/kphoto/more1.php?wxid='+wxid + "&openid=" + e_openid;
                else
                    location.href = 'http://'+wxid+'0.kagirl.cn/kphoto/more1.php?wxid='+shareid + "&openid=" + e_openid;
            }

        }

    }

    function on_wx_music_init()
    {
        if(e_desc != "")
        {
            document.title = e_desc.replace("<br>", "\n").replace("<br/>", "\n");;
        }
        else
        {
            document.title = "音乐相册";
        }
        loadingdiv_out();
        create_music();
        on_weixin_share();
        setTimeout(get_address, 500);

        if(wxid == 'zuiquan' || wxid == 'youran')
            read_localstorage();
        var locationurl = window.location.href;
        // if(locationurl.indexOf('debug')!=-1)
        // {
        check_cookie();
        // }

        if(editmode == false)
        {
            var obj = document.getElementById("guanzhu_container");
            obj.style.visibility = 'visible';
            if(navigator.userAgent.match(/MicroMessenger/) == null)
            {
                obj.innerHTML = "点我更多精彩";
                obj.style.display = 'none';
            }

            objid("jubao-click").style.display = "block";
            //var obj = document.getElementById("kawa-youli");
            //obj.style.visibility = 'visible';
        }
        var locationurl = window.location.href;
        if(locationurl.indexOf('hidden')!=-1)
        {
            objid('guanzhu_container').style.display = 'none';
        }


        if(locationurl.indexOf('noshow')!=-1)
        {
            objid('guanzhu_container').style.display = 'none';
        }

        if(editmode == false && app == "xdxj")
        {
            objid('guanzhu_container').style.display = 'block';
        }

        checkletter();

        if(tbssaveoff && isguangchang == "guangchang")
        {
            objid("saveoff").style.display = "block";
        }
    }

    //创建存储cookie的函数
    function set_cookie(value)
    {
        // value = "";
        // if(wxid == 'youyi')
        // 	document.cookie = "books="+value+';domain=.kawabody.cn';
        // else
        document.cookie = "books="+value+';domain=.kagirl.cn';
        // alert('write:'+document.cookie);
    }

    function get_cookie(c_name)
    {
        // alert(document.cookie);
        if(document.cookie.length > 0)
        {
            var c_start = document.cookie.indexOf(c_name + '=');
            if (c_start != -1)
            {
                c_start = c_start + c_name.length + 1;
                var c_end = document.cookie.indexOf(';', c_start);
                if(c_end == -1)
                    c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start,c_end));
            }

        }
        return '';
    }


    function check_cookie()
    {


        var thisbook = e_bookid + '&' + wxid;

        books = get_cookie('books');
        // alert(books);
        console.log('cookie:'+books);

        var locationurl = window.location.href;

        if(editmode == true || locationurl.indexOf('hidden') != -1)
        {
            objid('guanzhu_container').style.display = 'none';
            if(objid('guanzhubtn'))
            {
                objid('guanzhubtn').style.display = 'none';
                objid('reshowbtn').style.left = '163px';
            }

            //还没存进去
            cookie_str = '';
            if(books != null && books != '' && books.indexOf(thisbook) == -1)
            {
                cookie_str = books+ ':' + thisbook;

            }
            else if(books.indexOf(thisbook) != -1)
            {
                return;
            }
            else if(books == null || books == '')
            {
                cookie_str = thisbook;
            }

            set_cookie(cookie_str);
        }
        else
        {
            if(books !=null && books != '' && books.indexOf(thisbook) !=-1)
            {
                objid('guanzhu_container').style.display = 'none'
                if(objid('guanzhubtn'))
                {
                    objid('guanzhubtn').style.display = 'none';
                    objid('reshowbtn').style.left = '163px';
                }
            }
            else
            {
                objid('guanzhu_container').style.display = 'block';
            }
        }


        objid('guanzhu_container').style.webkitAnimation = 'guangzhu_ani 0.8s linear infinite alternate';
        if(wxid == 'xingkong' || wxid == 'aide' || wxid == 'ziji' || wxid == 'zuoyyxc' || wxid == 'woyao' || wxid == 'yyjn' || wxid == 'donggan')
        {
            objid('guanzhu_container').innerHTML = '点我制作相册';
        }

    }



    call_me(on_wx_music_init);

    //音乐播放

    var music_header   = 'http://kawaweika.qiniudn.com/sound/';
    var e_music_player = new Audio();

    function play_music()
    {
        if(e_music_url == '')
        {
            return ;
        }

        if(e_music_url.indexOf('qqmusic') != -1)
        {
            mymusic = 'https://qnphoto.kagirl.cn/music/688042.m4a';
        }
        else
        {
            mymusic = e_music_url;
        }

        e_music_player.src  = mymusic;
        e_music_player.loop = 'loop';

        console.log(e_music_player.src);
        e_music_player.onerror = function(){
            if(e_music_url.indexOf("http://sound.kagirl.net") != -1)
            {
                var url = e_music_url.replace("http://sound.kagirl.net", "https://music.kagirl.cn");
            }
            else
            {
                var url = e_music_url.replace("https://music.kagirl.cn", "http://sound.kagirl.net");
            }

            e_music_player.src = url;
            e_music_player.play();
            e_music_player.onerror = null;
        }

        e_music_player.play();

        //检查音乐是否缓冲成功
        setTimeout(function()
        {
            var timeRanges = e_music_player.buffered;
            var timeBuffered = timeRanges.end(timeRanges.length - 1);
            var bufferPercent = timeBuffered /e_music_player.duration;
            console.log('music:'+bufferPercent);

            if(isNaN(bufferPercent) || bufferPercent == 0)
            {
                if(e_music_url.indexOf("http://sound.kagirl.net") != -1)
                {
                    var url = e_music_url.replace("http://sound.kagirl.net", "http://kawaweika.qiniudn.com");
                }
                else
                {
                    var url = e_music_url.replace("https://music.kagirl.cn", "http://sound.kagirl.net");
                }
                e_music_player.src = url;
                e_music_player.play();
            }
        },5000);


        if(objid('sound_image'))
        {
            objid('sound_image').style.webkitAnimation     = "zhuan 1s linear infinite";
        }

        bplay = 1;
    }

    function create_music()
    {
        if(e_music_url == '')
        {
            return ;
        }

        play_music();

        sound_div = document.createElement("div");
        sound_div.setAttribute("ID", "cardsound");
        sound_div.style.cssText = "position:fixed;right:20px;top:25px;z-index:50;visibility:visible;";
        sound_div.onclick = switchsound;

        bg_htm  = "<img id='sound_image' src='img/music_note_big.png' style='-webkit-animation:zhuan 1s linear infinite'>";
        txt_htm = "<div id='music_txt' style='color:white;position:absolute;left:-40px;top:30px;width:60px'></div>"

        sound_div.innerHTML = bg_htm  + txt_htm;

        document.body.appendChild(sound_div);
    }

    var bplay = 0;

    function switchsound()
    {
        au = e_music_player;
        ai = objid('sound_image');
        if(au.paused)
        {
            bplay = 1;
            au.play();
            ai.style.webkitAnimation     = "zhuan 1s linear infinite";
            objid("music_txt").innerHTML = "打开";
            objid("music_txt").style.visibility = "visible";
            setTimeout(function(){objid("music_txt").style.visibility="hidden"}, 2500);
        }
        else
        {
            bplay = 0;
            au.pause();
            ai.style.webkitAnimation     = "";
            objid("music_txt").innerHTML = "关闭";
            objid("music_txt").style.visibility = "visible";
            setTimeout(function(){objid("music_txt").style.visibility="hidden"}, 2500);
        }
    }

    function visit_guanzhu()
    {
        if(navigator.userAgent.match(/MicroMessenger/))
        {
            // var sceneurl = 'adpv.php?click=7&scene='+e_scene+'&bookid='+e_bookid+'&wxid='+wxid;

            // XMLHttp.sendReq('GET', sceneurl, '', function(){
            //    });
            XMLHttp.sendReq('GET', 'tongjiscene.php?scene='+e_scene+'&type=guanzhu', '', function(){});
            location.href = guanzhu_url;


        }
        else
        {
            // location.href = "http://article.mp.qq.com/index.php/preview/show?p=cd8c8cf61eb8c661b2163815a8f35a59&m=1442370092841159&i=0&t=c005e9f4d683429f35044a50ba3c4ab1&_wv=134217729&v=3&env=10003&mpu=33303236323133363530";
        }
    }

    function get_address()
    {
        if(location.href.indexOf("bookid=FalD4jB6GUtphMyZUexe9A") == -1 && editmode == false)
        {
            url = "getip.php?";
            //XMLHttp.sendReq('GET', url, '', get_address_callback);
        }
    }
    function get_address_callback(objXMLHttp)
    {
        if(objXMLHttp.responseText.indexOf('深圳') != -1)
        {
            objid('guanzhu_container').style.webkitAnimation = "aa_out_bounce_left 0.5s .2s ease both";
            var obj = objid('shenzhen');
            obj.style.visibility = "visible";
            obj.style.webkitAnimation = "aa_in_bounce_center 0.5s .2s ease both";
            obj.href = "http://photo.kagirl.cn/kphoto/showbook.php?bookid=FalD4jB6GUtphMyZUexe9A&wxid=zhi&fromsz=true";
        }
    }

    function close_searchmusic()
    {
        objid('search_music').style.display = 'none';
        objid('search_music_result_div').innerHTML = '';
        e_music_player.play();
        reflush();
    }
    function search_musicshow()
    {
        objid('search_music').style.display='block';
        var width = document.body.clientWidth;
        var height = document.body.clientHeight;

        var div_height = 500/(width/height);
        objid('search_music_result').style.height = div_height-170 +'px';

    }
    add_music_xml = new XMLHttpRequest();
    function submit_addmusic () {

        var musicname = objid('music_name').value;
        if(musicname == null || musicname == '')
        {
            alert('音乐名称不能为空！');
        }
        else
        {
            var url = 'music_feedback.php?musicname='+musicname;
            add_music_xml.open('GET',url,true);
            add_music_xml.onreadystatechange = add_music_callback;
            add_music_xml.setRequestHeader('Content-type','application/x-www-form-urlencoded');
            add_music_xml.send(null);
        }
    }
    function trim(str)
    {
        return str.replace(/(^\s*)|(\s*$)/g,'');
    }
    function add_music_callback () {
        if (add_music_xml.readyState == 4)
        {
            if (add_music_xml.status== 200)
            {
                var result = add_music_xml.responseText;
                console.log(result);
                if(result.indexOf('1'))
                {
                    objid('add_music_result').style.display = 'block';
                }
                else
                    alert('提交失败，请稍后再试。')
            }
            // else
            // 	alert('提交失败，请稍后再试。');
        }
        // else
        // {
        // 	alert('提交失败，请稍后再试。');
        // }
    }
    music_xml = new XMLHttpRequest();
    function search_music ()
    {
        objid('search_music_result_div').innerHTML = '';
        objid('search_music_notice').style.display = 'block';

        var word = objid('search_musicname').value;
        word = trim(word);
        if(word == ''|| word == null || word == undefined)
        {
            alert('输入不能为空');
        }
        word = encodeURIComponent(word);

        // if(wxid == 'meiwen')
        // {
        // 	// url = 'http://photo.kagirl.cn/music/189/search.php?keyword='+word;
        // 	url = 'http://photo.kagirl.cn/music/search.php?music='+word;

        // 	objid('search_music_result_div').style.display = 'none';
        // }
        // else 
        // {
        url = '/music/search.php?music='+word;
        // url = 'http://photo.kagirl.cn/kphoto/musicsearch.php?music='+word;
        // }

        music_xml.open('GET',url, true);
        music_xml.onreadystatechange = SearchMusic_onCallback;
        music_xml.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        music_xml.send(null);

    }

    function SearchMusic_onCallback()
    {

        if(music_xml.readyState ==4)
        {
            if(music_xml.status == 200)
            {
                var result = music_xml.responseText;
                result = JSON.parse(result);
                var obj = objid('search_music_result_div');
                // alert(result.length)
                if(result.length == undefined || result.length == 0)
                {
                    var music_value = objid('search_musicname').value;
                    music_value = trim(music_value);
                    obj.innerHTML = '<div style="line-height:30px;margin:50px 10px 10px 10px;font-size:16px;"><p style="font-size:22px;line-height30px;">找不到与<b>"'+music_value+'"</b>相关音乐</p></div>';
                    obj.style.display = 'block';
                }
                else
                {
                    var htm_txt = '';
                    for(var i=0;i<result.length;i++)
                    {
                        htm_txt += '<div class="e-mp3box-item"><div class="e-mp3box-item-img"><img src="https://tu.kagirl.cn/icon/yinfu.png"></div><div id="search_music_result_text" class="e-mp3box-item-title" onclick="search_music_title_click('+"'"+result[i]['url']+"'"+','+i+')">'+result[i]['title']+'</div><div id="search_music_btn'+i+'" class="search-mp3box-item-ok" id="search-music-ok-'+i+'" onclick="search_music_select('+"'"+result[i]['musicname']+"'"+','+i+')">确定</div></div>';
                    }
                    obj.innerHTML = htm_txt;
                    obj.style.display = 'block';
                    // htm_txt += '<div class="e-mp3box-item-img"  id="e-music-img-'+(i+oks_num)+'"><img src="https://tu.kagirl.cn/icon/yinfu.png"></div>';

                    // htm_txt += '<div class="e-mp3box-item-title" onclick="e_music_title_click(\''+url+'\','+(i+oks_num)+')">'+title+'</div>';

                    // htm_txt += '<div class="e-mp3box-item-ok" id="e-music-ok-'+(i+oks_num)+'" onclick="e_music_select(\''+musicname+'\')">确定</div>';

                    // 		var str = '<div class="e-mp3box-item-img"><img src="https://tu.kagirl.cn/icon/yinfu.png"></div><div id="search_music_result_text" class="e-mp3box-item-title" onclick="search_music_title_click('+"'"+result['url']+"'"+')">'+result['title']+'</div><div id="search_music_result_btn" class="e-mp3box-item-ok" id="e-music-ok-0" onclick="search_music_select('+"'"+result['musicname']+"'"+')">确定</div>';
                    // 		obj.innerHTML = str;
                    // 		obj.style.display = 'block';					
                }

                // objid('search_music_result_text').innerHTML = result['title'];
                // objid('search_music_result_text').onclick="e_music_title_click('"+result['url']+"',0)";
                // objid('search_music_result_btn').onclick = "e_music_select('"+result['musicname']+"')";
                // objid('search_music_result').innerHTML = result;
            }
            else
            {
                console.log('Error: '+ music_xml.status)
            }
        }

        objid('search_music_result_div').style.display = 'block';
        objid('search_music_notice').style.display = 'none';
    }
    function search_music_title_click(url,index)
    {
        var oks = document.getElementsByClassName('search-mp3box-item-ok');

        for(var i=0;i<oks.length;i++)
        {
            oks[i].style.display = 'none';
        }
        objid('search_music_btn'+index).style.display = 'block';
        // objid('e-music-ok-' + index).style.display = 'block';
        //objid('e-music-img-' + index).style.webkitAnimation = 'zhuan 2.5s linear infinite';

        if(e_music_player != null)
        {
            e_music_player.pause();

            if(objid('sound_image'))
            {
                objid('sound_image').style.webkitAnimation = "";
            }
        }

        if(objid('e-player') == null)
        {
            var player  = document.createElement('audio');
            player.id   = 'e-player';
            player.src  = url;
            player.loop = 'loop';
            player.play();
            document.body.appendChild(player);
        }
        else if(objid('e-player').src == url)
        {
            if(objid('e-player').paused)
            {
                objid('e-player').play();
            }
            else
            {
                objid('e-player').pause();
                objid('e-music-img-' + index).style.webkitAnimation = '';
            }
        }
        else
        {
            objid('e-player').src = url;
            objid('e-player').play();
        }
    }

    function search_music_select(url)
    {
        objid('search_music').style.display = 'none';
        e_music_url = url;

        if(typeof(reload_scene) == "undefined")
        {
            var url = "editbook.php?";
            url	= url + 'type=set_music';
            url	= url + "&openid=" + e_openid;
            url	= url + "&bookid=" + e_bookid;
            url	= url + "&music=" + encodeURIComponent(e_music_url);
            url = url + "&wxid=" + wxid;

            XMLHttp.sendReq('GET', url, '', function(){
                location.reload();
            });
        }
        else
        {
            tool_close();

            if(e_music_player)
            {
                if(!objid('cardsound'))
                {
                    create_music();
                    e_music_player.play();
                }

                e_music_player.src = objid('e-player').src;
                e_music_player.play();
            }
            else
            {
                create_music();
            }

            e_close_wind();
            var url = "editbook.php?";
            url	= url + 'type=set_music';
            url	= url + "&openid=" + e_openid;
            url	= url + "&bookid=" + e_bookid;
            url	= url + "&music=" + encodeURIComponent(e_music_url);
            url = url + "&wxid=" + wxid;

            XMLHttp.sendReq('GET', url, '', function(){
                //location.reload();
            });
        }


    }
    var bjubao_type = false;
    function showjubaoimg (num)
    {
        var img = objid('jubaoimg-'+num);
        if(img.style.display == 'none')
        {

            var imgarr = document.getElementsByClassName('jubao-radio');
            for(var i=0;i<imgarr.length;i++)
            {
                imgarr[i].style.display = 'none';
            }
            img.style.display = 'block';
            if(objid("jubao-detail").value >=5)
            {
                objid('jubao-submit').style.display = 'block';
            }
            bjubao_type = true;
        }
        else
        {
            img.style.display = 'none';
            objid('jubao-submit').style.display = 'none';
            bjubao_type = false;

        }
    }
    function showjubaoimg2()
    {
        if(objid("jubao-detail").value.length >= 5 && bjubao_type)
        {
            objid('jubao-submit').style.display = 'block';
        }
        else
        {
            objid('jubao-submit').style.display = 'none';
        }
    }
    function showjubao ()
    {
        if(localStorage.getItem(e_bookid + wxid) == "1")
        {
            alert("您已经反馈过这个相册了");
            return;
        }
        objid('jubao-content').style.display = 'block';
    }
    function hidejubao ()
    {
        objid('jubao-content').style.display = 'none';
    }
    function submitjubao ()
    {
        if(objid("jubao-detail").value.length < 5)
        {
            alert("问题描述字数太少！");
            return;
        }
        var img_arr = document.getElementsByClassName('jubao-radio');
        var jubao_type = 0;
        while(img_arr[jubao_type].style.display == 'none')
        {
            jubao_type++;
        }
        alert('反馈提交成功！');
        id('jubao-content').style.display = 'none';
        localStorage.setItem(e_bookid + wxid, 1);
        var jubaourl = 'http://photo1.kagirl.cn/kphoto/jubao.php?bookid='+e_bookid+'&wxid='+wxid+'&type='+jubao_type + "&detail=" + encodeURIComponent(objid("jubao-detail").value);
        XMLHttp.sendReq("get", jubaourl, "", function(objXMLHttp){
        });
    }
    function visit_guanggao()
    {
        window.location.href = 'adpv.php?click=6';
    }
    function visit_sousuo()
    {

    }
    function write_localstorage()
    {
        console.log('write');
        objid('like_div').onclick = function(){};


        var url = 'submit_like.php?bookid='+e_bookid+'&wxid='+wxid;
        XMLHttp.sendReq('GET',url,'',function()
        {
            objid('like_heart').src='https://qnphoto.kagirl.cn/zan/like0.png';
            objid('like_heart').style.webkitAnimation = 'heart_beating 0.4s linear 4 alternate';
            objid('heart1').style.display = 'block';
            objid('heart2').style.display = 'block';
            objid('heart3').style.display = 'block';
            objid('heart1').style.webkitAnimation = 'heart1_moving 1.6s 0.2s linear both';
            objid('heart2').style.webkitAnimation = 'heart2_moving 1.6s 0.2s linear both';
            objid('heart3').style.webkitAnimation = 'heart3_moving 1.6s 0.2s linear both';
            objid('like_num').innerHTML = zan_num +1;

            // var day = new Date();
            // var daystr = day.get
            var sendstr = e_bookid + wxid + date;

            if(localStorage.likestr == null || localStorage == undefined)
            {
                var like_arr = [];
            }
            else
            {
                var like_arr = JSON.parse(localStorage.likestr);
            }

            if(like_arr.length == 50)
            {
                like_arr.pop()
            }
            like_arr.unshift(sendstr);

            likestr = JSON.stringify(like_arr);
            // console.log(likestr);
            localStorage.likestr = likestr;

        })


    }

    function nottofeedback()
    {
        if(bjubao_type == false)
            alert('您已经反馈过这个相册了')
        else
            alert('反馈必须不少于5个字');
    }

    function read_localstorage()
    {

        if(editmode == false )
        {
            objid('like_div').style.display = 'block';
        }
        console.log(localStorage.likestr);
        if(localStorage.likestr == null || localStorage == undefined)
        {
            objid('like_div').onclick = write_localstorage;
        }
        else
        {
            var like_arr = JSON.parse(localStorage.likestr);
            var sendstr = e_bookid + wxid + date;
            console.log(sendstr);
            for(var i=0;i<like_arr.length;i++)
            {
                if(like_arr[i] == sendstr)
                {
                    objid('like_heart').src = 'https://qnphoto.kagirl.cn/zan/like0.png';
                    break;
                }
                else if(i == like_arr.length-1)
                {
                    objid('like_div').onclick = write_localstorage;
                    // console.log('canclick');
                }
            }
        }
        // console.log(objid("like_div").onclick);
        objid('like_num').innerHTML = zan_num;
    }

    function visit_guangchang()
    {
        var locationurl = location.href;
        if(shareid != '' && shareid != undefined)
        {
            if(locationurl.indexOf('hidden') != -1)
            {
                if(locationurl.indexOf('menu') != -1)
                    location.href = 'http://photo.kagirl.cn/kphoto/menu.php?wxid='+shareid;
                else
                    location.href = 'http://photo.kagirl.cn/kphoto/more1.php?back=true&wxid='+shareid;
            }
            else
                location.href = 'http://photo.kagirl.cn/kphoto/more1.php?back=true&show=true&wxid='+shareid;
        }
    }
    function loadingdiv_out()
    {
        objid('loadingdiv').style.webkitAnimation = 'fadeout 0.3s linear both';
        if(navigator.userAgent.indexOf('Windows Phone')!=1)
        {
            objid('loadingdiv').style.display = 'none';
        }

        setTimeout(function()
        {
            objid('loadingdiv').style.display = 'none';
        },400)
    }
    function checkletterbtn()
    {
        XMLHttp.sendReq("get", 'tongjiscene.php?type=baoguang', "", function(objXMLHttp){
        });
    }
    function clickbtn()
    {
        XMLHttp.sendReq("get", 'tongjiscene.php?type=click', "", function(objXMLHttp){
        });
    }

    function openletter()
    {
        objid('letterdiv').style.display = 'block';
        objid('letter').src='http://qnimg.kagirl.cn/guangchang/letter1.png';
        objid('letter').style.height = '120px';
        objid('letter').style.top = '-40px';
        if(objid('letternotice').style.display = 'block')
            clickbtn();
        objid('letternotice').style.display = 'none';
        setletter();
        // clickbtn();
    }
    function closeletter()
    {
        objid('letterdiv').style.display = 'none';
        objid('letterpicdiv').style.display = 'none';
        objid('letter').src='http://qnimg.kagirl.cn/guangchang/letter.jpg';
        objid('letter').style.height = '80px';
        objid('letter').style.top = '0px';
    }
    var newletter = '20160919';
    function checkletter()
    {
        return;
        var locationurl = window.location.href;
        if(objid('guanzhu_container').style.display == 'none' && locationurl.indexOf('more') == -1 &locationurl.indexOf('hidden') == -1 )
        {
            if(editmode == false && navigator.userAgent.match(/MicroMessenger/) != null)
            {
                var myid = wxid;
                if(shareid !='')
                    myid = shareid;
                XMLHttp.sendReq("get", 'checkshow.php?wxid='+myid, "", function(objXMLHttp)
                {
                    var txt = objXMLHttp.responseText;
                    if(txt == '1' || txt == 1)
                    {
                        var lastletter = get_cookie('letterid');
                        if(lastletter != newletter)
                        {
                            objid('letternotice').style.display = 'block';
                            checkletterbtn();
                        }
                        objid('letterpicdiv').style.display = 'block';

                        objid('letterurl').href = 'http://'+myid+'0.kagirl.cn/kphoto/showbook.php?bookid=Fpx5HcVlzcoeBQTEYDTytoNHTkMN9UXW&wxid=chuanqi&more=redpoint&hidden&shareid='+myid;
                        XMLHttp.sendReq("get", 'getname.php?id='+myid, "", function(objXMLHttp){
                            var txt = objXMLHttp.responseText;
                            objid('lettername').innerHTML = "来自："+txt+'&nbsp;&nbsp;&nbsp;';
                        });
                    }

                });

            }
        }

    }

    function setletter()
    {
        var lastletter = get_cookie('letterid');

        if(lastletter != newletter)
        {
            document.cookie = "letterid="+newletter+';domain=.kagirl.cn';
        }
    }
    function saveoff()
    {
        location.href = "saveoffstat.php?type=guangchang&bookid=" + e_bookid + "&wxid=" + wxid;
    }
    function savepic()
    {
        var locationurl = location.href;
        location.href = locationurl.replace('showbook','psinfo1');

    }
</script>
<!--
    <div id="guanzhu_container" style="visibility:hidden" ontouchstart="visit_guanzhu()">

		<div id="pxvcLXEqA-an-obj-1">
			<div>
				<img height="28" width="29"  src="https://qnphoto.kagirl.cn/guanzhu/dian.png">
			</div>
		</div>
		
		<div id="pxvcLXEqA-an-obj-2">
			<div>
				<img height="26" width="28"  src="https://qnphoto.kagirl.cn/guanzhu/zhe.png">
			</div>
		</div>
		
		<div id="pxvcLXEqA-an-obj-3">
			<div>
				<img height="26" width="28"  src="https://qnphoto.kagirl.cn/guanzhu/li.png">
			</div>
		</div>
		
		<div id="pxvcLXEqA-an-obj-4">
			<div>
				<img  height="27" width="26"  src="https://qnphoto.kagirl.cn/guanzhu/zi.png">
			</div>
		</div>
		
		<div id="pxvcLXEqA-an-obj-5">
			<div>
				<img  height="27" width="28"  src="https://qnphoto.kagirl.cn/guanzhu/ji.png">
			</div>
		</div>

		<div id="pxvcLXEqA-an-obj-6">
			<div>
				<img  height="27" width="28"  src="https://qnphoto.kagirl.cn/guanzhu/zuo.png">
			</div>
		</div>

		<div id="pxvcLXEqA-an-obj-7">
			<div>
				<img  height="26" width="29"  src="https://qnphoto.kagirl.cn/guanzhu/xiang.png">
			</div>
		</div>

		<div id="pxvcLXEqA-an-obj-8">
			<div>
				<img  height="27" width="28"  src="https://qnphoto.kagirl.cn/guanzhu/ce.png">
			</div>
		</div>

		<div id="pxvcLXEqA-an-obj-9">

			<div id="pxvcLXEqA-an-obj-10">
				<div id="pxvcLXEqA-an-obj-11">
					<div>
						<img  height="12" width="20"  src="https://qnphoto.kagirl.cn/guanzhu/kawa2.png">
					</div>
					<div id="pxvcLXEqA-an-obj-12">
						<div>
							<img  height="8" width="10"  src="https://qnphoto.kagirl.cn/guanzhu/kawa3.png">
						</div>
					</div>
				</div>
			</div>

			<div id="pxvcLXEqA-an-obj-13">
				<div>
					<img  height="80" width="65"  src="https://qnphoto.kagirl.cn/guanzhu/kawa1.png">
				</div>
			</div>

			<div id="pxvcLXEqA-an-obj-14">
				<div>
					<img  height="12" width="20"  src="https://qnphoto.kagirl.cn/guanzhu/kawa2.png">
				</div>
			</div>
		</div>		
	</div>
-->

<a id="guanzhu_container" ontouchstart="visit_guanzhu()" class="large green button" style="visibility:hidden;text-align:center;line-height:30px;font-size:22px;position:fixed;bottom:20px;left:150px;width:200px;height:45px;z-index:10000">自己做相册</a>
<!-- 	<div id='licaitong' style='position:fixed;width:86px;bottom:0px;opacity:0.8;left:413px;height:103px;' onclick='window.location.href="https://qian.tenpay.com/weixin/action/shake150818/index.shtml?actid=50091&min_reward_money=200&stat_data=fm_162_llhb_5&stat_type=68&ADTAG=2015.ACT.LLHB.HB5"'  ontouchstart='window.location.href="https://qian.tenpay.com/weixin/action/shake150818/index.shtml?actid=50091&min_reward_money=200&stat_data=fm_162_llhb_5&stat_type=68&ADTAG=2015.ACT.LLHB.HB5"'>
		<img src='image/guanggao/jiao2.png' style='width:86px;'>
		<img src='image/guanggao/jinbi.png' style='position:absolute;left:57px;top:68px;-webkit-animation: jinbi 1.5s linear infinite alternate;width:25px;'>
	</div> -->
<div id='jubao-click' style='display:none;width:500px;height:50px;position:fixed;bottom:0px;color:white;text-shadow:1px 1px 1px #000;opacity:0.5;z-index:100'>
    <div style='position:absolute;text-align:center;width:500px;top:35px;text-decoration:none;font-size:12px;'>该相册为用户个人作品，非公众号发布</div>
    <div  onclick="showjubao()" style="position:absolute;left:420px;top:-16px;text-shadow: none;background-color: rgba(0, 0, 0, 0.5);width: 45px;height: 45px;border-radius: 50%;font-size: 16px;line-height: 45px;text-align: center;">反馈</div>
</div>
<div id="kawa-youli" style="position:fixed;width:50px;height:50px;visibility:hidden;
    background-color:#dd0000;color:yellow;text-align:center;
    border-radius:25px;bottom:18px;
    right:10px;padding:0px;margin:0px;
    -webkit-box-sizing:border-box;
    -webkit-box-shadow: #666 0px 0px 10px;
    font-size:8pt;padding-top:11px;z-index:9999;"
     ontouchstart="location.href='http://photo.kagirl.cn/kphoto/htm/toyouli.htm'">
    <b>卡娃<br>心意坊</b>
</div>

<div id='jubao-content' style='position:absolute;width:400px;background-color:#fff;height:540px;top:100px;left:50px;display:none;z-index:15000'>
    <div style='width:400px;height:45px;background-color:rgb(250,97,65);text-align:center;font-size:22px;color:#fff;line-height:45px;'>意见反馈或投诉</div>
    <div id='jubao-1' class='jubao-item' onclick='showjubaoimg(0)'>色情低俗<img id='jubaoimg-0' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div id='jubao-2' class='jubao-item' onclick='showjubaoimg(1)'>谣言<img id='jubaoimg-1' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div id='jubao-3' class='jubao-item' onclick='showjubaoimg(2)'>诱导分享<img id='jubaoimg-2' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div id='jubao-4' class='jubao-item' onclick='showjubaoimg(3)'>政治敏感<img id='jubaoimg-3' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div id='jubao-5' class='jubao-item' onclick='showjubaoimg(4)'>冒用或诽谤他人<img id='jubaoimg-4' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div id='jubao-6' class='jubao-item' onclick='showjubaoimg(5)'>相册播放有问题<img id='jubaoimg-5' class='jubao-radio' style='display:none' src='https://qnphoto.kagirl.cn/pic/jubao/jubao.png'></div>
    <div class="jubao-detail">
        <textarea id="jubao-detail" placeholder="问题描述（必填，至少5个字）" oninput="showjubaoimg2()" maxlength="100"></textarea>
    </div>
    <div onclick='hidejubao()' id='jubao-cancel' style='position:absolute;width:120px;height:40px;background-color:#ACABAB;left:47px;top:480px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;'>取消</div>
    <div onclick='nottofeedback()' style='position:absolute;width:120px;height:40px;background-color:#ACABAB;left:229px;top:480px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;'>提交</div>
    <div onclick='submitjubao()' id='jubao-submit' style='position:absolute;width:120px;height:40px;background-color:rgb(250,97,65);left:229px;top:480px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;display:none'>提交</div>
</div>
<div id='musicinfo' ontouchstart='visit_sousuo()'>
    查看歌曲
</div>
<div id='morexiangce' onclick='visit_guangchang()'>
    欣赏更多相册
</div>
<div id="saveoff" onclick="saveoff()">
    离线保存
</div>
<div id="savepic" onclick="savepic()">
    保存图片
</div>
<!--  <div id='guanggaodiv' style='width:150px;height:100px;position:fixed;left:-10px;bottom:0px;-webkit-transform: scale(0.8);z-index:200;display:none' ontouchstart='visit_guanggao()'>
 	<img src='https://qnphoto.kagirl.cn/guanggao/muqin3.png' style='width:145px;'>
    <div  style='position:absolute;left:-80px;-webkit-animation: che_ani 7s linear infinite;-webkit-transform-origin: 100% 100%;width:100px;height:47px;top:40px;'>
        <img src='https://qnphoto.kagirl.cn/pic/ad/che1.png' style='width:100px;position:absolute'>
        <img src='https://qnphoto.kagirl.cn/pic/ad/che.png' style='width:100px;position:absolute;-webkit-animation: che1_ani 7s linear infinite;'>
    </div>
    <img src='https://qnphoto.kagirl.cn/pic/ad/word1.png' style='position:absolute;left:10px;top:-22px;-webkit-transform: rotate(20deg) scale(0.75);-webkit-animation: shijia 7s linear infinite'>
    <img src='https://qnphoto.kagirl.cn/pic/ad/word2.png' style='position:absolute;left:10px;top:0px;-webkit-animation: baoming 7s linear infinite'>
    <img src='https://qnphoto.kagirl.cn/pic/ad/bm.png' style='position:absolute;left:93px;top:32px;width:25px;-webkit-animation: biaozhi_ani 7s infinite'>
</div> -->

<div id='like_div' style='position:absolute;width:100px;height:50px;background-color:rgba(0,0,0,0.5);border-radius: 0px 25px 25px 0px;top:40px;display:none;z-index:10000'>
    <img id='like_heart' src='https://qnphoto.kagirl.cn/zan/like1.png' style='position:absolute;left:38px;top:-3px;width:55px;'>
    <div id='like_num' style='position:absolute;color:rgba(255,255,255,0.7);font-size:20px;top:0px;left:0px;width:50px;height:50px;text-align:center;line-height:50px;'></div>

    <img src='https://qnphoto.kagirl.cn/zan/like0.png' id='heart1' style='position:absolute;width:25px;top:8px;left:44px;display:none'>
    <img src='https://qnphoto.kagirl.cn/zan/like0.png' id='heart2' style='position:absolute;width:25px;top:8px;left:63px;display:none'>
    <img src='https://qnphoto.kagirl.cn/zan/like0.png' id='heart3' style='position:absolute;width:25px;top:22px;left:52px;display:none'>

</div>
<div id='enddiv'>
    <div id='title_div'>
        <div id='title_text' style='top:0px;left:0px;right:0px;bottom:0px;vertical-align:middle;display:table-cell;'></div>
    </div>
    <div id='title_line'></div>
    <div id='reshowbtn' ontouchstart='reload_scene()'>再看一遍</div>
    <div id='guanzhubtn' ontouchstart='visit_guanzhu()'>我要制作</div>
</div>

<div id='loadingdiv'>
    <div class='loadingword'>相册正在加载中<br>请稍等……</div>
</div>

<div id='letterpicdiv'>
    <img id='letter' src='http://qnimg.kagirl.cn/guangchang/letter.jpg' onclick='openletter()'>
    <div id='letternotice'>1</div>
</div>

<div id='letterdiv'>
    <div class='lettercon'>
        <div class='lettertitle'>最新消息</div>
        <div class='lettercontent'>
            <img class='letterimg' src='https://qnphoto.kagirl.cn/icon/rose.jpg'><br>
            <div style='margin-top:10px;'>有一份爱，铭记于心<br>有一份情，相守到老<br>这份情书，写给你的……</div>
        </div>
        <div id='lettername'></div>
        <a id='letterurl'><div class='newxiangce' >点击查看最美情书</div></a>

        <div class='letterclose' onclick='closeletter()'>×</div>
    </div>

</div>
<!--
	<a id="shenzhen" style="visibility:hidden;text-align:center;line-height:30px;font-size:22px;position:fixed;bottom:20px;left:275px;width:200px;height:45px;z-index:10000;" class="large blue button" href="#">点我看深圳夜景</a>
-->

<!-- <script type="text/javascript" src="http://tajs.qq.com/stats?sId=49849725" charset="UTF-8"></script> -->
<!-- <script type="text/javascript" src="http://tajs.qq.com/stats?sId=51790002" charset="UTF-8"></script> -->



<style type="text/css">

    .e-menu
    {
        position: fixed;
        top: 100%;
        left: 0px;
        height: 46px;
        margin-top:-65px;
        width: 500px;
        z-index: 10002;
        -webkit-box-sizing: border-box;
    }

    .e-menu-item
    {
        position: relative;
        float: left;
        width: 100px;
        height: 100%;
        line-height: 46px;
        text-align: center;
        font-size: 16pt;
        border: 1px solid #E1E1E1;
        border-radius: 24px;
        color: white;
        margin-left: 20px;
        -webkit-box-sizing: border-box;
    }
    .e-opacity-back
    {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-color: black;
        border-radius: 24px;
        opacity: 0.6;
        -webkit-box-sizing: border-box;
    }
    #e-wind
    {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        background-color: white;
        overflow: hidden;
        z-index: 10001;
        -webkit-box-sizing: border-box;
    }

    #e-wind-title
    {
        position: relative;
        width: 100%;
        height: 60px;
        color: white;
        font-size: 18pt;
        line-height: 60px;
        padding-left: 4%;
        -webkit-box-sizing: border-box;
        color: #62370D;
        background-color: #FFC148;
    }

    #e-wind-close
    {
        position: absolute;
        top: 0px;
        float: right;
        right: 20px;
        height: 100%;
        line-height: 60px;
        font-size: 40pt;
        -webkit-box-sizing: border-box;
    }

    #e-wind-content
    {
        width: 100%;
        height: 100%;
        overflow-y:auto;
        -webkit-overflow-scrolling: touch;
        -webkit-box-sizing: border-box;
    }

    #e-wind-content > div
    {
        height: 100%;
    }

    .e-template-item
    {
        position: relative;
        float: left;
        width: 140px;
        margin:10px 0 0 20px;
        height: 176px;
        border-left:1px solid #dddddd;
        border-top: 1px solid #dddddd;
        box-shadow:2px 2px 3px #dddddd;
        padding: 5px;
        -webkit-box-sizing: border-box;
        /*visibility: hidden;*/
    }

    .e-template-item img
    {
        position: relative;
        width: 129px;
        height: 129px;
        -webkit-box-sizing: border-box;
    }
    .e-template-item span
    {
        width: 100%;
        line-height: 50px;
        text-align: center;
        display: block;
        font-size: 15pt;
        font-family: '微软雅黑';
    }

    .e-content-bottom
    {
        position: relative;
        float: left;
        width: 500px;
        height: 120px;
        -webkit-box-sizing: border-box;
    }

    #e-music-menu,#e-template-menu
    {
        width: 100%;
        height: 50px;
        line-height: 50px;
        background:-webkit-gradient(linear, 0% 50%, 100% 50%,from(rgb(93,81,65)), to(rgb(75,65,63)));
        -webkit-box-sizing: border-box;
    }

    #e-music-menu div
    {
        /*padding-left: 20px;*/
        position: relative;
        float: left;
        color: white;
        font-size: 20px;
        width: 65px;
        text-align: center;
        -webkit-box-sizing: border-box;
    }
    #e-template-menu div
    {
        padding-left: 28px;
        position: relative;
        float: left;
        color: white;
        font-size: 15pt;
        -webkit-box-sizing: border-box;
    }
    #e-mp3box,#e-template-box
    {
        position: absolute;
        height: 620px;
        width: 500px;
        overflow-y:auto;
        -webkit-overflow-scrolling: touch;
        -webkit-box-sizing: border-box;
    }

    .e-mp3box-item
    {
        position: relative;
        height: 80px;
        width: 100%;
        border-bottom: 2px ridge #E5E5E5;
        -webkit-box-sizing: border-box;
    }

    .e-mp3box-item-img
    {
        position: relative;
        float: left;
        margin:24px 0 0 20px;
        -webkit-box-sizing: border-box;
    }

    .e-mp3box-item-title
    {
        position: relative;
        float: left;
        text-align:left;
        margin-left:10px;
        width:68%;
        font-size:17pt;
        font-weight:bold;
        color:black;
        height:80px;
        line-height:80px;
        overflow: hidden;
        -webkit-box-sizing: border-box;
    }

    .e-mp3box-item-ok,.search-mp3box-item-ok
    {
        position: relative;
        display: none;
        float: right;
        text-align: center;
        height:40px;
        line-height:38px;
        margin: 20px 20px 0 0 ;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        width: 65px;
        background-color: #FFC148;
        color: #62370D;
        border-radius: 7px 7px 7px 7px;
        border: 2px solid #FFB120;	}

    .e-addpic-btn
    {
        width: 200px;
        height: 50px;
        line-height: 48px;
        text-align: center;
        margin: 16px 0 16px 150px;
        font-size: 18pt;
        border-radius: 30px;
        border:2px solid #FFB120;
        color: #62370D;
        background-color: #FFC148;
    }

    .e-addpic-tip
    {
        position: absolute;
        width: 460px;
        left: 20px;
        height: 400px;
        background-color: white;
        display: none;
        z-index: 1;
        top: 20px;
        -webkit-box-sizing: border-box;
        text-align: center;
    }

    .e-addpic-tip span
    {
        display: block;
        width: 400px;
        text-align: center;
        font-size: 15pt;
        line-height: 30px;
        font-weight: bold;
        margin: 20px 0 5px 30px;
        -webkit-box-sizing: border-box;
    }

    .e-addpic-tip div
    {
        position: relative;
        float: left;
        width: 110px;
        height: 40px;
        line-height: 40px;
        color: white;
        text-align: center;
        border-radius: 30px;
        background-color: #FA6141;
        margin-left: 80px;
        margin-top: 5px;
        font-size: 15pt;
        -webkit-box-sizing: border-box;
    }

    .e-del-pic
    {
        position: absolute;
        width: 155px;
        height: 200px;
        background-size: cover;
        background-position: center;
    }


    .e-del-item
    {
        position: relative;
        float: left;
        width: 155px;
        margin: 16px 0 0 8px;
        height: 200px;
        border: 1px solid #BFBFBF;
        box-shadow: 2px 2px 3px #aaaaaa;
    }

    .e-del-ok
    {
        position: absolute;
        width: 25px;
        height: 25px;
        line-height: 25px;
        font-size: 25pt;
        -webkit-box-sizing: border-box;
        right: 0px;
    }

    .e-del-ok > div
    {
        border-radius: 50% !important;
        z-index: 0 !important;
        position: absolute;
        color: white;
        text-align: center;
        width: 100%;
        height: 100%;
        -webkit-box-sizing: border-box;
        background-color: #555;
    }
    .e-del-ok > img
    {
        position: absolute;
        width: 25px;
    }


    .e-del-move
    {
        position: absolute;
        bottom: -2px;
        width: 155px;
        height: 35px;
    }
    .e-del-move > img
    {
        height: 25px;
        margin-top: 5px;
        position: absolute;
        z-index: 1;
        opacity: 0.8;
    }
    .e-del-move > div
    {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: black;
        opacity: 0.5;
    }

    .e-del-move > img:nth-child(2)
    {
        left:16px;
        -webkit-transform: rotate(180deg);
    }
    .e-del-move > img:nth-child(3)
    {
        right: 16px;
    }


    .e-del-bigpic
    {
        /*		width: 160px;
		margin: 8px;
		height: 160px;
		background-size: cover;
		border: 1px solid #BFBFBF;
		box-shadow: 2px 2px 3px #aaaaaa;
		-webkit-box-sizing: border-box;
		-webkit-touch-callout: none;
		-webkit-user-select: none;*/
        width: 160px;
        margin: 8px;
        height: 160px;
        background-size: cover;
        border: 1px solid #BFBFBF;
        box-shadow: 2px 2px 3px #aaaaaa;
        -webkit-box-sizing: border-box;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        position: relative;
        float: left;
    }

    .e-del-bigitem
    {
        /*		width: 500px;
		border-bottom: 1px solid #ddd;
		position: relative;
		background-color: white;*/
        width: 500px;
        border-bottom: 1px solid #ddd;
        position: relative;
        background-color: white;
        height: 182px;
    }

    .e-del-bigok
    {
        /*		position: absolute;
		bottom: 8px;
		right: 116px;*/
        position: relative;
        top: 71px;
        float: right;
        right: 97px;
    }
    .e-del-bigup
    {
        /*		position: absolute;
		bottom: 8px;
		right: 16px;*/
        position: relative;
        top: 139px;
        right: 7px;
        float: right;
    }
    .e-del-bigdown
    {
        /*		position: absolute;
		bottom: 8px;
		right: 66px;*/
        position: relative;
        top: 105px;
        left: -51px;
        float: right;
    }

    .e-del-bigok > div
    {
        border-radius: 50% !important;
        z-index: 0 !important;
        position: absolute;
        color: white;
        text-align: center;
        width: 100%;
        height: 100%;
        -webkit-box-sizing: border-box;
    }


    #e-share-words , #e-share-title
    {
        line-height: 33px;
        width: 493px;
        padding: 6px 12px;
        background: #e4e4e4;
        font-size: 18pt;
        resize: none;
        outline: none;
        margin: 6px 3px;
        border: 1px solid rgba(0,0,0,0.12);
        -webkit-appearance: none;
    }


    #e-share-title
    {
        line-height: 65px;
        -webkit-box-sizing: border-box;
    }

    .e-share-ok
    {
        color: white;
        font-size: 18pt;
        font-weight: bold;
        height: 70px;
        line-height: 70px;
        text-align: center;
        background-color: rgb(250,97,65);
        -webkit-box-sizing: border-box;
    }
    #e-rechoose-music
    {
        position: absolute;
        top: 17px;
        left: 100px;
        background-color: #FDAE00;
        border-radius: 7px;
        color: #fff;
        width: 70px;
        height: 30px;
        font-size: 14px;
        line-height: 30px;
        text-align: center;
        /*opacity: 0;*/
    }

    @-webkit-keyframes up-pic {
        0% {
            -webkit-transform: translateY(0px);
        }
        100% {
            -webkit-transform: translateY(-177px);
        }
    }
    @-webkit-keyframes down-pic {
        0% {
            -webkit-transform: translateY(0px);
        }
        100% {
            -webkit-transform: translateY(177px);
        }
    }

    .editwords
    {
        position: relative;
        top: 18px;
        left: 10px;
        height: 116px;
        width: 275px;
        resize: none;
        border: none;
        border-radius: 4px;
        font-size: 22px;
        line-height: 30px;
        color: #555;
        background-color: #fff;
        padding: 6px 12px;
        word-break: break-all;
        word-wrap: break-word;
        float: left;
    }
    .words-tip
    {
        padding: 8px;
        border-bottom: 1px solid #ddd;
        color: rgb(64,64,64);
        font-size: 18px;
        height: 16px;
    }
</style>

<div class="e-menu" id="e-menu">
    <div class="e-menu-item" onclick="e_templates(1)">
        <div>选模板</div>
        <div class="e-opacity-back"></div>
    </div>
    <div class="e-menu-item" onclick="e_musics(2)">
        <div>选音乐</div>
        <div class="e-opacity-back"></div>
    </div>
    <div class="e-menu-item" onclick="e_pics(3)">
        <div>改相片</div>
        <div class="e-opacity-back"></div>
    </div>
    <div class="e-menu-item" onclick="e_words(4)">
        <div>写文字</div>
        <div class="e-opacity-back"></div>
    </div>
</div>
<div id="e-wind" style="display:none">
    <div id="e-wind-title">
        <div id="e-title-words">选择模板</div>
        <div id='e-rechoose-music' onclick='reset_music()' style='opacity:0;'>默认音乐</div>
        <div id="e-wind-close" onclick="reflush()">×</div>
    </div>
    <div id="e-wind-content">

        <div id="e-content-1">
            <div id='e-template-menu'>
                <div id="e-template-type-hot" onclick="e_template_type('hot')">热门</div>
                <div id="e-template-type-xinqing"  style="color:rgb(214,66,90)" onclick="e_template_type('xinqing')">心情</div>
                <div id="e-template-type-aiqing"  style="color:rgb(214,66,90)" onclick="e_template_type('aiqing')">爱情</div>
                <div id="e-template-type-ertong"  style="color:rgb(214,66,90)" onclick="e_template_type('ertong')">儿童</div>
                <div id="e-template-type-jieri"  style="color:rgb(214,66,90)" onclick="e_template_type('jieri')">祝福</div>
                <div id="e-template-type-fengjing"  style="color:rgb(214,66,90)" onclick="e_template_type('fengjing')">多图</div>
                <div id="e-template-type-3d"  style="color:rgb(214,66,90)" onclick="e_template_type('3d')">大图</div>
            </div>
            <div id='e-template-box' onscroll="e_template_scroll()">
                <div id='template-yumao' class="e-template-item" onclick="e_template_click('yumao')">
                    <img data-id="yumao" data-src="https://qnphoto.kagirl.cn/icon/yumao.jpg">
                    <span>多彩嘉年华</span>
                </div>
                <div id='template-rose' class="e-template-item" onclick="e_template_click('rose')">
                    <img data-id="rose" data-src="https://qnphoto.kagirl.cn/icon/rose.jpg">
                    <span>钟爱一生</span>
                </div>
                <div id='template-xiangyin' class="e-template-item" onclick="e_template_click('xiangyin')">
                    <img data-id="xiangyin" data-src="https://qnphoto.kagirl.cn/icon/xiangyin.jpg">
                    <span>心心相印</span>
                </div>
                <div id='template-dahua' class="e-template-item" onclick="e_template_click('dahua')">
                    <img data-id="dahua" data-src="https://qnphoto.kagirl.cn/icon/dahua.jpg">
                    <span>玫瑰之恋</span>
                </div>
                <div id='template-chongyang' class="e-template-item" onclick="e_template_click('chongyang')">
                    <img data-id="chongyang" data-src="https://qnphoto.kagirl.cn/icon/chongyang.jpg">
                    <span>秋意浓</span>
                </div>
                <div id='template-flowers' class="e-template-item" onclick="e_template_click('flowers')">
                    <img data-id="flowers" data-src="https://qnphoto.kagirl.cn/icon/flowers.jpg">
                    <span>花的故事</span>
                </div>
                <div id='template-autumn' class="e-template-item" onclick="e_template_click('autumn')">
                    <img data-id="autumn" data-src="https://qnphoto.kagirl.cn/icon/autumn.jpg">
                    <span>秋实</span>
                </div>

                <div id='template-moon' class="e-template-item" onclick="e_template_click('moon')">
                    <img data-id="moon" data-src="https://qnphoto.kagirl.cn/icon/moon.jpg">
                    <span>海上生明月</span>
                </div>
                <div id='template-hualuo' class="e-template-item" onclick="e_template_click('hualuo')">
                    <img data-id="hualuo" data-src="https://qnphoto.kagirl.cn/icon/hualuo.jpg">
                    <span>花落知多少</span>
                </div>
                <div id='template-qingren' class="e-template-item" onclick="e_template_click('qingren')">
                    <img data-id="qingren" data-src="https://qnphoto.kagirl.cn/icon/qingren.jpg">
                    <span>浪漫满屋</span>
                </div>
                <div id='template-jiniance' class="e-template-item" onclick="e_template_click('jiniance')">
                    <img data-id="jiniance" data-src="https://qnphoto.kagirl.cn/icon/jiniance.jpg">
                    <span>纪念册</span>
                </div>
                <div id='template-summer' class="e-template-item" onclick="e_template_click('summer')">
                    <img data-id="summer" data-src="https://qnphoto.kagirl.cn/icon/summer.jpg">
                    <span>夏天的味道</span>
                </div>
                <div id='template-shatan' class="e-template-item" onclick="e_template_click('shatan')">
                    <img data-id="shatan" data-src="https://qnphoto.kagirl.cn/icon/shatan.jpg">
                    <span>快乐一夏</span>
                </div>
                <div id='template-faya' class="e-template-item" onclick="e_template_click('faya')">
                    <img data-id="faya" data-src="https://qnphoto.kagirl.cn/icon/faya.jpg">
                    <span>春意</span>
                </div>
                <div id='template-qiufeng' class="e-template-item" onclick="e_template_click('qiufeng')">
                    <img data-id="qiufeng" data-src="https://qnphoto.kagirl.cn/icon/qiufeng.jpg">
                    <span>秋兮枫离</span>
                </div>
                <div id='template-senlin' class="e-template-item" onclick="e_template_click('senlin')">
                    <img data-id="senlin" data-src="https://qnphoto.kagirl.cn/icon/senlin.jpg">
                    <span>奇幻森林</span>
                </div>
                <div id='template-lonely' class="e-template-item" onclick="e_template_click('lonely')">
                    <img data-id="lonely" data-src="https://qnphoto.kagirl.cn/icon/lonely.jpg">
                    <span>雨中漫步</span>
                </div>
                <div id='template-yixia' class="e-template-item" onclick="e_template_click('yixia')">
                    <img data-id="yixia" data-src="https://qnphoto.kagirl.cn/icon/yixia.jpg">
                    <span>夏之清凉</span>
                </div>
                <div id='template-qingchun' class="e-template-item" onclick="e_template_click('qingchun')">
                    <img data-id="qingchun" data-src="https://qnphoto.kagirl.cn/icon/qingchun.jpg">
                    <span>致青春</span>
                </div>
                <div id='template-naxienian' class="e-template-item" onclick="e_template_click('naxienian')">
                    <img data-id="naxienian" data-src="https://qnphoto.kagirl.cn/icon/naxienian.jpg">
                    <span>那些年</span>
                </div>
                <div id='template-tongxue' class="e-template-item" onclick="e_template_click('tongxue')">
                    <img data-id="tongxue" data-src="https://qnphoto.kagirl.cn/icon/tongue.jpg">
                    <span>同学录</span>
                </div>
                <div id='template-shiyi' class="e-template-item" onclick="e_template_click('shiyi')">
                    <img data-id="shiyi" data-src="https://qnphoto.kagirl.cn/icon/shiyi.jpg">
                    <span>欢度国庆</span>
                </div>
                <div id='template-yuanxiao' class="e-template-item" onclick="e_template_click('yuanxiao')">
                    <img data-id="yuanxiao" data-src="https://qnphoto.kagirl.cn/icon/yuanxiao1.jpg">
                    <span>花好月圆</span>
                </div>
                <div id='template-zhongqiu1' class="e-template-item" onclick="e_template_click('zhongqiu1')">
                    <img data-id="zhongqiu1" data-src="https://qnphoto.kagirl.cn/icon/zhongqiu1.jpg">
                    <span>团圆美满</span>
                </div>
                <div id='template-teacher' class="e-template-item" onclick="e_template_click('teacher')">
                    <img data-id="teacher" data-src="https://qnphoto.kagirl.cn/icon/teacher.jpg">
                    <span>校园回忆</span>
                </div>

                <div id='template-qian' class="e-template-item" onclick="e_template_click('qian')">
                    <img data-id="qian" data-src="https://qnphoto.kagirl.cn/icon/qian.jpg">
                    <span>恭喜发财</span>
                </div>
                <div id='template-qiqiu' class="e-template-item" onclick="e_template_click('qiqiu')">
                    <img data-id="qiqiu" data-src="https://qnphoto.kagirl.cn/icon/qiqiu.jpg">
                    <span>梦幻气球</span>
                </div>
                <div id='template-lianhua' class="e-template-item" onclick="e_template_click('lianhua')">
                    <img data-id="lianhua" data-src="https://qnphoto.kagirl.cn/icon/lianhua.jpg">
                    <span>蝶恋花</span>
                </div>
                <div id='template-haibo' class="e-template-item" onclick="e_template_click('haibo')">
                    <img data-id="haibo" data-src="https://qnphoto.kagirl.cn/icon/haibo.jpg">
                    <span>阳光沙滩</span>
                </div>
                <div id='template-yelu' class="e-template-item" onclick="e_template_click('yelu')">
                    <img data-id="yelu" data-src="https://qnphoto.kagirl.cn/icon/yelu.jpg">
                    <span>甜蜜梦乡</span>
                </div>
                <div id='template-quanping' class="e-template-item" onclick="e_template_click('quanping')">
                    <img data-id="quanping" data-src="https://qnphoto.kagirl.cn/icon/quanping.jpg">
                    <span>情书</span>
                </div>
                <div id='template-gray' class="e-template-item" onclick="e_template_click('gray')">
                    <img data-id="gray" data-src="https://qnphoto.kagirl.cn/icon/gray.jpg">
                    <span>水墨丹青</span>
                </div>

                <div id='template-xingxing' class="e-template-item" onclick="e_template_click('xingxing')">
                    <img data-id="xingxing" data-src="https://qnphoto.kagirl.cn/icon/xingxing.jpg">
                    <span>生活剪影</span>
                </div>
                <div id='template-balloon' class="e-template-item" onclick="e_template_click('balloon')">
                    <img data-id="balloon" data-src="https://qnphoto.kagirl.cn/icon/balloon.jpg">
                    <span>自由天空</span>
                </div>
                <div id='template-junhun' class="e-template-item" onclick="e_template_click('junhun')">
                    <img data-id="junhun" data-src="https://qnphoto.kagirl.cn/icon/junhun.jpg">
                    <span>军魂</span>
                </div>

                <div id='template-bamboo' class="e-template-item" onclick="e_template_click('bamboo')">
                    <img data-id="bamboo" data-src="https://qnphoto.kagirl.cn/icon/qingzhu.jpg">
                    <span>夏日青竹</span>
                </div>

                <div id='template-birthday' class="e-template-item" onclick="e_template_click('birthday')">
                    <img data-id="birthday" data-src="https://qnphoto.kagirl.cn/icon/birthday.jpg">
                    <span>生日祝福</span>
                </div>
                <div id='template-maxituan' class="e-template-item" onclick="e_template_click('maxituan')">
                    <img data-id="maxituan" data-src="https://qnphoto.kagirl.cn/icon/maxituan.jpg">
                    <span>儿童乐园</span>
                </div>
                <div id='template-shengri' class="e-template-item" onclick="e_template_click('shengri')">
                    <img data-id="shengri" data-src="https://qnphoto.kagirl.cn/icon/shengri.jpg">
                    <span>生日快乐</span>
                </div>
                <div id='template-qixi' class="e-template-item" onclick="e_template_click('qixi')">
                    <img data-id="qixi" data-src="https://qnphoto.kagirl.cn/icon/xiangyi.jpg">
                    <span>相依相偎</span>
                </div>

                <div id='template-fuqin' class="e-template-item" onclick="e_template_click('fuqin')">
                    <img data-id="fuqin" data-src="https://qnphoto.kagirl.cn/icon/fuqin.jpg">
                    <span>时光放映机</span>
                </div>

                <div id='template-wuyijie' class="e-template-item" onclick="e_template_click('wuyijie')">
                    <img data-id="wuyijie" data-src="https://qnphoto.kagirl.cn/icon/wuyijie.jpg">
                    <span>环游世界</span>
                </div>
                <div id='template-fengche' class="e-template-item" onclick="e_template_click('fengche')">
                    <img data-id="fengche" data-src="https://qnphoto.kagirl.cn/icon/fengche.jpg">
                    <span>浪漫风车</span>
                </div>

                <div id='template-baby' class="e-template-item" onclick="e_template_click('baby')">
                    <img data-id="baby" data-src="https://qnphoto.kagirl.cn/icon/baby.jpg">
                    <span>宝宝相册</span>
                </div>
                <div id='template-nanfeng' class="e-template-item" onclick="e_template_click('nanfeng')">
                    <img data-id="nanfeng" data-src="https://qnphoto.kagirl.cn/icon/nanfeng.jpg">
                    <span>童心未泯</span>
                </div>
                <div id='template-yuedu' class="e-template-item" onclick="e_template_click('yuedu')">
                    <img data-id="yuedu" data-src="https://qnphoto.kagirl.cn/icon/yuedu.jpg">
                    <span>旧时回忆</span>
                </div>
                <div id='template-biyeji' class="e-template-item" onclick="e_template_click('biyeji')">
                    <img data-id="biyeji" data-src="https://qnphoto.kagirl.cn/icon/biyeji1.jpg">
                    <span>毕业季</span>
                </div>
                <div id='template-cubeover' class="e-template-item" onclick="e_template_click('cubeover')">
                    <img data-id="cubeover" data-src="https://qnphoto.kagirl.cn/icon/01.jpg">
                    <span>3D魔方</span>
                </div>

                <div id='template-xinnian2' class="e-template-item" onclick="e_template_click('xinnian2')">
                    <img data-id="xinnian2" data-src="https://qnphoto.kagirl.cn/icon/xinnian2.jpg">
                    <span>猴年大吉</span>
                </div>
                <div id='template-duanwu' class="e-template-item" onclick="e_template_click('duanwu')">
                    <img data-id="duanwu" data-src="https://qnphoto.kagirl.cn/icon/duanwu.jpg">
                    <span>端午节祝福</span>
                </div>
                <div id='template-ertongjie' class="e-template-item" onclick="e_template_click('ertongjie')">
                    <img data-id="ertongjie" data-src="https://qnphoto.kagirl.cn/icon/ertongjie.jpg">
                    <span>快乐六一</span>
                </div>
                <div id='template-shanshui' class="e-template-item" onclick="e_template_click('shanshui')">
                    <img data-id="shanshui" data-src="https://qnphoto.kagirl.cn/icon/shanshui.jpg">
                    <span>梦幻暮色</span>
                </div>

                <div id='template-xiaozhen' class="e-template-item" onclick="e_template_click('xiaozhen')">
                    <img data-id="xiaozhen" data-src="https://qnphoto.kagirl.cn/icon/xiaozhen.jpg">
                    <span>童话小镇</span>
                </div>

                <div id='template-liming' class="e-template-item" onclick="e_template_click('liming')">
                    <img data-id="liming" data-src="https://qnphoto.kagirl.cn/icon/liming.jpg">
                    <span>清晨黎明</span>
                </div>

                <div id='template-wuwangwo' class="e-template-item" onclick="e_template_click('wuwangwo')">
                    <img data-id="wuwangwo" data-src="https://qnphoto.kagirl.cn/icon/wuwangwo.jpg">
                    <span>勿忘我</span>
                </div>
                <div id='template-moshang' class="e-template-item" onclick="e_template_click('moshang')">
                    <img data-id="moshang" data-src="https://qnphoto.kagirl.cn/icon/moshang.jpg">
                    <span>墨上花开</span>
                </div>
                <div id='template-baokan' class="e-template-item" onclick="e_template_click('baokan')">
                    <img data-id="baokan" data-src="https://qnphoto.kagirl.cn/icon/baokan.jpg">
                    <span>温暖时光</span>
                </div>
                <div id='template-bingxue' class="e-template-item" onclick="e_template_click('bingxue')">
                    <img data-id="bingxue" data-src="https://qnphoto.kagirl.cn/icon/snow.jpg">
                    <span>冰雪奇缘</span>
                </div>
                <div id='template-yanyu' class="e-template-item" onclick="e_template_click('yanyu')">
                    <img data-id="yanyu" data-src="https://qnphoto.kagirl.cn/icon/yanyu.jpg">
                    <span>烟雨蒙蒙</span>
                </div>
                <div id='template-qingxin' class="e-template-item" onclick="e_template_click('qingxin')">
                    <img data-id="qingxin" data-src="https://qnphoto.kagirl.cn/icon/qingxin.jpg">
                    <span>伊然清新</span>
                </div>
                <div id='template-qianlv' class="e-template-item" onclick="e_template_click('qianlv')">
                    <img data-id="qianlv" data-src="https://qnphoto.kagirl.cn/icon/qianlv.jpg">
                    <span>清风蝶影</span>
                </div>
                <div id='template-lvxing' class="e-template-item" onclick="e_template_click('lvxing')">
                    <img data-id="lvxing" data-src="https://qnphoto.kagirl.cn/icon/lvxing.jpg">
                    <span>足迹</span>
                </div>
                <div id='template-maode' class="e-template-item" onclick="e_template_click('maode')">
                    <img data-id="maode" data-src="https://qnphoto.kagirl.cn/icon/maode.jpg">
                    <span>猫的节奏</span>
                </div>
                <div id='template-nvren' class="e-template-item" onclick="e_template_click('nvren')">
                    <img data-id="nvren" data-src="https://qnphoto.kagirl.cn/icon/nvren1.jpg">
                    <span>动感光线</span>
                </div>


                <div id='template-xinchun' class="e-template-item" onclick="e_template_click('xinchun')">
                    <img data-id="xinchun" data-src="https://qnphoto.kagirl.cn/icon/xinchun.jpg">
                    <span>金猴贺岁</span>
                </div>

                <div id='template-xinnian1' class="e-template-item" onclick="e_template_click('xinnian1')">
                    <img data-id="xinnian1" data-src="https://qnphoto.kagirl.cn/icon/xinnian1.jpg">
                    <span>新年快乐</span>
                </div>
                <div id='template-xinnian' class="e-template-item" onclick="e_template_click('xinnian')">
                    <img data-id="xinnian" data-src="https://qnphoto.kagirl.cn/icon/xinnian.jpg">
                    <span>欢度新年</span>
                </div>
                <div id='template-fulushou' class="e-template-item" onclick="e_template_click('fulushou')">
                    <img data-id="fulushou" data-src="https://qnphoto.kagirl.cn/icon/fulushou.jpg">
                    <span>福禄寿</span>
                </div>


                <div id='template-zazhi' class="e-template-item" onclick="e_template_click('zazhi')">
                    <img data-id="zazhi" data-src="https://qnphoto.kagirl.cn/icon/zazhi.jpg">
                    <span>梦幻光影</span>
                </div>


                <div id='template-xiantiao' class="e-template-item" onclick="e_template_click('xiantiao')">
                    <img data-id="xiantiao" data-src="https://qnphoto.kagirl.cn/icon/xiantiao.jpg">
                    <span>向日葵</span>
                </div>
                <div id='template-huijia' class="e-template-item" onclick="e_template_click('huijia')">
                    <img data-id="huijia" data-src="https://qnphoto.kagirl.cn/icon/huijia.jpg">
                    <span>回家过年</span>
                </div>
                <!-- 				<div id='template-pinzhi' class="e-template-item" onclick="e_template_click('pinzhi')">
					<img data-id="pinzhi" data-src="https://qnphoto.kagirl.cn/icon/pinzhi.jpg">
					<span>品质生活</span>
				</div> -->
                <div id='template-meishi' class="e-template-item" onclick="e_template_click('meishi')">
                    <img data-id="meishi" data-src="https://qnphoto.kagirl.cn/icon/meishi.jpg">
                    <span>美味佳肴</span>
                </div>
                <div id='template-xinfeng' class="e-template-item" onclick="e_template_click('xinfeng')">
                    <img data-id="xinfeng" data-src="https://qnphoto.kagirl.cn/icon/chunxin.jpg">
                    <span>远方的信</span>
                </div>

                <div id='template-snow' class="e-template-item" onclick="e_template_click('snow')">
                    <img data-id="snow" data-src="https://qnphoto.kagirl.cn/icon/xuehua.jpg">
                    <span>雪花</span>
                </div>

                <div id='template-morning' class="e-template-item" onclick="e_template_click('morning')">
                    <img data-id="morning" data-src="https://qnphoto.kagirl.cn/icon/morning.jpg">
                    <span>阳光宝贝</span>
                </div>
                <div id='template-green' class="e-template-item" onclick="e_template_click('green')">
                    <img data-id="green" data-src="https://qnphoto.kagirl.cn/icon/green.jpg">
                    <span>绿色心情</span>
                </div>

                <div id='template-xingfu' class="e-template-item" onclick="e_template_click('xingfu')">
                    <img data-id="xingfu" data-src="https://qnphoto.kagirl.cn/icon/xingfu.jpg">
                    <span>幸福时光</span>
                </div>

                <div id='template-xuandong' class="e-template-item" onclick="e_template_click('xuandong')">
                    <img data-id="xuandong" data-src="https://qnphoto.kagirl.cn/icon/xuandong1.jpg">
                    <span>炫动星空</span>
                </div>

                <div id='template-minion' class="e-template-item" onclick="e_template_click('minion')">
                    <img data-id="minion" data-src="https://qnphoto.kagirl.cn/icon/minion.jpg">
                    <span>快乐宝贝</span>
                </div>


                <div id='template-lovetrip' class="e-template-item" onclick="e_template_click('lovetrip')">
                    <img data-id="lovetrip" data-src="https://qnphoto.kagirl.cn/icon/lovetrip.jpg">
                    <span>爱的旅程</span>
                </div>
                <div id='template-huazhou' class="e-template-item" onclick="e_template_click('huazhou')">
                    <img data-id="huazhou" data-src="https://qnphoto.kagirl.cn/icon/guyun.jpg">
                    <span>古韵画轴</span>
                </div>
                <div id='template-guoqing' class="e-template-item" onclick="e_template_click('guoqing')">
                    <img data-id="guoqing" data-src="https://qnphoto.kagirl.cn/icon/guoqing.jpg">
                    <span>旅行志</span>
                </div>



                <div id='template-jingjing' class="e-template-item" onclick="e_template_click('jingjing')">
                    <img data-id="jingjing" data-src="https://qnphoto.kagirl.cn/icon/jingjing.jpg">
                    <span>星光点点</span>
                </div>

                <div id='template-paopao' class="e-template-item" onclick="e_template_click('paopao')">
                    <img data-id="paopao" data-src="https://qnphoto.kagirl.cn/icon/paopao.jpg">
                    <span>五彩泡泡</span>
                </div>

                <div id='template-love' class="e-template-item" onclick="e_template_click('love')">
                    <img data-id="love" data-src="https://qnphoto.kagirl.cn/icon/love2.jpg">
                    <span>爱情</span>
                </div>

                <div id='template-flip' class="e-template-item" onclick="e_template_click('flip')">
                    <img data-id="flip" data-src="https://qnphoto.kagirl.cn/icon/02.jpg">
                    <span>深邃星空</span>
                </div>

                <div id='template-brick' class="e-template-item" onclick="e_template_click('brick')">
                    <img data-id="brick" data-src="https://qnphoto.kagirl.cn/icon/04.jpg">
                    <span>3D酷翻</span>
                </div>
                <div id='template-shengdan2' class="e-template-item" onclick="e_template_click('shengdan2')">
                    <img data-id="shengdan2" data-src="https://qnphoto.kagirl.cn/icon/shengdan2.jpg">
                    <span>圣诞祝福</span>
                </div>
                <div id='template-shengdan1' class="e-template-item" onclick="e_template_click('shengdan1')">
                    <img data-id="shengdan1" data-src="https://qnphoto.kagirl.cn/icon/shengdan1.jpg">
                    <span>欢乐圣诞</span>
                </div>
                <div id='template-shengdan' class="e-template-item" onclick="e_template_click('shengdan')">
                    <img data-id="shengdan" data-src="https://qnphoto.kagirl.cn/icon/shengdan.jpg">
                    <span>圣诞快乐</span>
                </div>
                <div id='template-bubble' class="e-template-item" onclick="e_template_click('bubble')">
                    <img data-id="bubble" data-src="https://qnphoto.kagirl.cn/icon/03.jpg">
                    <span>调皮泡泡</span>
                </div>

                <div id='template-roll' class="e-template-item" onclick="e_template_click('roll')">
                    <img data-id="roll" data-src="https://qnphoto.kagirl.cn/icon/05.jpg">
                    <span>欢乐时光</span>
                </div>

                <div id='template-junhun1' class="e-template-item" onclick="e_template_click('junhun1')">
                    <img data-id="junhun1" data-src="https://qnphoto.kagirl.cn/icon/junhun1.jpg">
                    <span>建军节</span>
                </div>
                <div id='template-zhongqiu' class="e-template-item" onclick="e_template_click('zhongqiu')">
                    <img data-id="zhongqiu" data-src="https://qnphoto.kagirl.cn/icon/zhongqiu.jpg">
                    <span>秋情依依</span>
                </div>
                <div id='template-heimao' class="e-template-item" onclick="e_template_click('heimao')">
                    <img data-id="heimao" data-src="https://qnphoto.kagirl.cn/icon/heimao.jpg">
                    <span>黑猫警长</span>
                </div>

                <div class="e-content-bottom"></div>
            </div>


        </div>

        <div id="e-content-2">
            <div id="e-music-menu">
                <div id="e-music-type-hot" onclick="e_music_type_click('hot')">热门</div>
                <div id="e-music-type-wangluo"  style="color:rgb(214,66,90)" onclick="e_music_type_click('wangluo')">网络</div>
                <div id="e-music-type-pop"  style="color:rgb(214,66,90)" onclick="e_music_type_click('pop')">流行</div>
                <div id="e-music-type-old"  style="color:rgb(214,66,90)" onclick="e_music_type_click('old')">怀旧</div>
                <div id="e-music-type-pure"  style="color:rgb(214,66,90)" onclick="e_music_type_click('pure')">纯音乐</div>


                <!-- 	    		<div id="e-music-type-birthday"  style="color:rgb(214,66,90)" onclick="e_music_type_click('birthday')">生日</div> -->
                <div id="e-music-type-child"  style="color:rgb(214,66,90);" onclick="e_music_type_click('child')">儿歌</div>
                <!-- <div id="e-music-type-guoqing"  style="color:rgb(214,66,90);" onclick="e_music_type_click('guoqing')">国庆</div> -->
                <div id='more_music' style='position:absolute;width:80px;height:40px;border-radius:5px;margin-top:5px;left:410px;color:white;background-color:#AF4352;border-radius:5px;font-size:20px;line-height:40px;text-align:center;padding-left:0px;' onclick='search_musicshow()'>搜索</div>
            </div>
            <div id="e-mp3box" onscroll="e_more_music()">
            </div>
        </div>
        <div id="e-content-3">
            <div class="e-addpic-tip" id="e-addpic-tip">
                <span>返回公众号输入界面，并点击下方”添加图片“按钮，来增加图片。</span>
                <img src="https://qnphoto.kagirl.cn/icon/help2.jpg">
                <span>确定增加图片吗？</span>
                <div onclick="e_addpic_ok()">确定</div>
                <div onclick="e_addpic_cancle()">取消</div>
            </div>
            <div id="e-pics-content"></div>
            <div class="e-addpic-btn" onclick="e_add_pic()">新增图片</div>
        </div>
        <div id="e-content-4">
            <!--
    		<div class="e-share-title">
    			<textarea id="e-share-title" maxlength="15" rows="1" placeholder="分享标题(限15字)..."></textarea>
    		</div>
    		-->
            <div id="e-bigpics-content"  onscroll="bigpic_scroll()" ></div>
            <div class="e-addpic-btn" id="e-addpic-btn" onclick="e_pics_complete()">完成</div>
            <!-- <div class="e-share-words">
    			<textarea id="e-share-words" maxlength="30" rows="3" placeholder="分享文字(限30字)..."></textarea>
    		</div>
    		<div class="e-share-ok" onclick="e_set_desc()">确定</div> -->
        </div>
    </div>
</div>
<div id='search_music' style='position:absolute;width:500px;height:815px;background-color:white;top:0px;left:0px;z-index:10003;display:none;'>
    <div style='position:relative;width:500px;height:60px;color: #62370D;background-color: #FFC148;padding-left:20px;font-size:25px;line-height:60px;'>搜索音乐</div>
    <div style='color:white;font-size:40pt;line-height:60px;position:absolute;width:60px;height:60px;top:0px;left:440px;' onclick='close_searchmusic()'>×</div>
    <input id='search_musicname' style='width:380px;height:50px;position:relative;margin:20px 0px 0px 15px;font-size:20px;padding-left:5px;' placeholder='请输入您想查找的歌曲名称' maxlength="25"/>
    <div id='search_music_submit' style='position:absolute;width:87px;border:2px solid #FFB120;color: #62370D;background-color: #FFC148;;height:50px;left:403px;top:81px;font-size:23px;text-align:center;line-height:48px;border-radius:10px;' onclick='search_music()'>搜索</div>
    <div id='search_music_result' style='position:relative;margin: 10px 0px 0px 10px;width:480px;height:600px;overflow:auto;'>
        <div id='search_music_result_div' style='display:none;border:0px;' class="e-mp3box-item">

        </div>
        <div id='search_music_notice' style='display:none;margin-top:20px;text-align:center;width:100%;font-size:20px;'>
            音乐正在搜索中，请稍后……
        </div>
    </div>

</div>


<script type="text/javascript" src="js/xmlHttp.js"></script>

<script type="text/javascript">

    //
    function objid(id)
    {
        return document.getElementById(id);
    }

    function reflush()
    {
        if(typeof(reload_scene) == "undefined")
        {
            var url = "http://" + location.host + location.pathname + "?edit=3&bookid=" + e_bookid + "&openid=" + e_openid + "&wxid=" + wxid + "&scene=" + e_scene + "&rand=" + Math.random();

            location.href = url;
        }
        else
        {
            reload_scene();
        }
        e_close_wind();
    }

    function e_close_wind()
    {
        tool_close();

        objid('e-wind').style.display = 'none';
        objid("e-menu").style.display = "block";

        if(objid('e-player'))
        {
            objid('e-player').pause();
        }
    }

    var titles = ["选模板","选音乐","修改图片","写文字"];

    function e_open_wind(index)
    {
        tool_open();

        if(index == 2)
            objid('e-rechoose-music').style.display = 'block';
        else
            objid('e-rechoose-music').style.display = 'none';

        var wind 					= objid('e-wind');
        wind.style.display 			= 'block';

        for(var i=1;i<=4;i++)
        {
            objid('e-content-' + i).style.display  = 'none';
        }

        objid('e-content-' + index).style.display  = 'block';

        objid('e-title-words').innerHTML = titles[index-1];
    }

    //
    function e_templates(index)
    {

        e_close_wind();
        e_open_wind(index);

        if(wxid == 'qinzi' || wxid == 'baobao' || wxid == 'mama')
        {
            e_template_type('ertong');
        }
        else
        {
            e_template_scroll();
        }
    }

    function e_template_scroll()
    {
        var content = objid("e-template-box");
        var count = 0;
        var total = Math.ceil((content.clientHeight+content.scrollTop)/186)*3;
        var divs = document.getElementsByClassName("e-template-item");
        for(var i = 0; i<divs.length; i++)
        {
            if(divs[i].style.display != "none")
            {
                var img = divs[i].children[0];
                if(img.getAttribute("src") == null)
                {
                    img.setAttribute("src", img.getAttribute("data-src"));
                    // divs[i].style.visibility = "visible";
                    (function(obj) {
                        setTimeout(function(){
                            obj.style.visibility = "visible";
                        }, 100);
                    })(divs[i]);
                }
                count++;
                if(count >= total)
                {
                    return;
                }
            }
        }
    }

    function e_template_click(scene)
    {
        var url = 'showbook.php?edit=2&bookid={1}&openid={2}&scene={3}&wxid={4}';

        url = url.replace('{1}', e_bookid);
        url = url.replace('{2}', e_openid);
        url = url.replace('{3}', scene);
        url = url.replace('{4}', wxid);

        location.href = url;
    }

    //音乐
    var e_music_page   = 0;
    var e_music_num    = 20;
    var e_music_header = 'http://kawaweika.qiniudn.com/sound/';
    var e_music_type   = 'pop';

    function tool_open()
    {
        document.ontouchmove = null;

        if(objid('container'))
        {
            objid('container').style.display= 'none';
        }
    }

    function tool_close()
    {
        document.ontouchmove = function(e)
        {
            e.preventDefault();
        }
        if(objid('container'))
        {
            objid('container').style.display= 'block';
        }
    }

    function e_musics(index)
    {
        e_close_wind();
        e_open_wind(index);

        e_music_type  = 'hot';

        // objid('e-music-type-hot').style.color = 'rgb(214,66,90)';
        objid('e-music-type-pop').style.color = 'rgb(214,66,90)';
        objid('e-music-type-pure').style.color = 'rgb(214,66,90)';
        objid('e-music-type-old').style.color = 'rgb(214,66,90)';
        objid('e-music-type-wangluo').style.color = 'rgb(214,66,90)';
        objid('e-music-type-child').style.color = 'rgb(214,66,90)';
        objid('e-music-type-hot').style.color = 'white';

        e_music_page  = 0;

        objid('e-mp3box').innerHTML = '';

        var url = "musicstock1.php?";
        url = url + 'type=hot';
        url = url + "&start=" + e_music_page*e_music_num;
        url = url + "&count=" + e_music_num;

        XMLHttp.sendReq('GET', url, '', e_music_callback);
    }

    function e_more_music()
    {
        var obj = objid('e-mp3box');

        if (e_music_type == 'hot')
            return;
        if(obj.scrollTop + obj.clientHeight + 10 >= obj.scrollHeight)
        {
            var url = "musicstock1.php?";
            url = url + 'type=' + e_music_type;
            url = url + "&start=" + e_music_page*e_music_num;
            url = url + "&count=" + e_music_num;

            XMLHttp.sendReq('GET', url, '', e_music_callback);
        }
    }

    function e_music_type_click(type)
    {
        e_music_type = type;
        e_music_page = 0;

        objid('e-mp3box').innerHTML = '';

        objid('e-music-type-hot').style.color = 'rgb(214,66,90)';
        objid('e-music-type-pop').style.color = 'rgb(214,66,90)';
        objid('e-music-type-pure').style.color = 'rgb(214,66,90)';
        objid('e-music-type-old').style.color = 'rgb(214,66,90)';
        //objid('e-music-type-wangluo').style.color = 'rgb(214,66,90)';
        objid('e-music-type-wangluo').style.color = 'rgb(214,66,90)';
        objid('e-music-type-child').style.color = 'rgb(214,66,90)';
        // objid('e-music-type-guoqing').style.color = 'rgb(214,66,90)';
        objid('e-music-type-' + type).style.color = 'white';

        var url	= "musicstock1.php?";
        url	= url + 'type=' + e_music_type;
        url	= url + "&start=" + e_music_page*e_music_num;
        url	= url + "&count=" + e_music_num;

        XMLHttp.sendReq('GET', url, '', e_music_callback);
    }

    function e_music_callback(objXMLHttp)
    {
        if(objXMLHttp.responseText == "0")
        {
            if(objid('e-more-music'))
            {
                objid('e-mp3box').removeChild(objid('e-more-music'));
            }

            return ;
        }

        var music_list = JSON.parse(objXMLHttp.responseText);

        if(objid('e-more-music'))
        {
            objid('e-mp3box').removeChild(objid('e-more-music'));
        }

        var mp3box  = objid('e-mp3box');

        var oks_num = document.getElementsByClassName('e-mp3box-item-ok').length;

        for(var i=0; i<music_list.length; i++)
        {
            var one = music_list[i];
            var title = one.title;
            var url = one.url;
            var musicname = one.musicname;
            var div = document.createElement('div');

            div.setAttribute('class','e-mp3box-item');

            var htm_txt = '';

            htm_txt += '<div class="e-mp3box-item-img"  id="e-music-img-'+(i+oks_num)+'"><img src="https://tu.kagirl.cn/icon/yinfu.png"></div>';

            htm_txt += '<div class="e-mp3box-item-title" onclick="e_music_title_click(\''+url+'\','+(i+oks_num)+')">'+title+'</div>';

            htm_txt += '<div class="e-mp3box-item-ok" id="e-music-ok-'+(i+oks_num)+'" onclick="e_music_select(\''+musicname+'\')">确定</div>';

            div.innerHTML = htm_txt;

            mp3box.appendChild(div);
        }

        if(music_list.length == e_music_num)
        {
            var div = document.createElement('div');
            div.setAttribute('class','e-mp3box-item');
            div.id  = 'e-more-music';

            div.innerHTML = '<div class="e-mp3box-item-title" style="text-align:center;width:90%">加载中...</div>';

            mp3box.appendChild(div);
        }

        e_music_page++;
    }

    function e_music_title_click(url,index)
    {
        var oks = document.getElementsByClassName('e-mp3box-item-ok');

        for(var i=0;i<oks.length;i++)
        {
            objid('e-music-ok-' + i).style.display = 'none';
            objid('e-music-img-' + i).style.webkitAnimation = '';
        }

        objid('e-music-ok-' + index).style.display = 'block';
        //objid('e-music-img-' + index).style.webkitAnimation = 'zhuan 2.5s linear infinite';

        if(e_music_player != null)
        {
            e_music_player.pause();

            if(objid('sound_image'))
            {
                objid('sound_image').style.webkitAnimation     = "";
            }
        }

        if(objid('e-player') == null)
        {
            var player  = document.createElement('audio');
            player.id   = 'e-player';
            player.src  = url;
            player.loop = 'loop';
            player.autoplay = 'autoplay';
            player.play();
            document.body.appendChild(player);
        }
        else if(objid('e-player').src == url)
        {
            if(objid('e-player').paused)
            {
                objid('e-player').play();
            }
            else
            {
                objid('e-player').pause();
                objid('e-music-img-' + index).style.webkitAnimation = '';
            }
        }
        else
        {
            objid('e-player').src = url;
            objid('e-player').play();
        }
    }

    function e_music_select(url)
    {
        e_music_url = url;

        if(typeof(reload_scene) == "undefined")
        {
            var url = "editbook.php?";
            url	= url + 'type=set_music';
            url	= url + "&openid=" + e_openid;
            url	= url + "&bookid=" + e_bookid;
            url	= url + "&music=" + encodeURIComponent(e_music_url);
            url = url + "&wxid=" + wxid;

            XMLHttp.sendReq('GET', url, '', function(){
                location.reload();
            });
        }
        else
        {
            tool_close();

            if(e_music_player)
            {
                if(!objid('cardsound'))
                {
                    create_music();
                    e_music_player.play();
                }

                e_music_player.src = objid('e-player').src;
                e_music_player.play();
            }
            else
            {
                create_music();
            }

            e_close_wind();
            var url = "editbook.php?";
            url	= url + 'type=set_music';
            url	= url + "&openid=" + e_openid;
            url	= url + "&bookid=" + e_bookid;
            url	= url + "&music=" + encodeURIComponent(e_music_url);
            url = url + "&wxid=" + wxid;

            XMLHttp.sendReq('GET', url, '', function(){
                //location.reload();
            });
        }



    }

    //删图
    function e_pics(index)
    {
        e_close_wind();
        e_open_wind(index);
        init_height();

        var obj = objid('e-pics-content');

        obj.innerHTML = '';

        for(var i = 0; i<slider_images_url.length;i++)
        {
            var div = document.createElement('div');
            div.id  = 'e-del-pic-' + i;
            div.className = 'e-del-item';

            var photo_id  = get_pid(slider_images_url[i]);

            div.innerHTML = '<div class="e-del-pic" style="background-image:url('+slider_images_url[i]+')"></div>\
			<div class="e-del-ok" onclick="e_del_pic('+i+', \'' + photo_id + '\')"><img src="https://qnphoto.kagirl.cn/icon/cha.png"></div><div class="e-del-move">\
				<div></div>\
				<img  onclick="e_move_pic('+i+', \'' + photo_id + '\', \'up\')" src="https://qnphoto.kagirl.cn/icon/snajiao.png">\
				<img  onclick="e_move_pic('+i+', \'' + photo_id + '\', \'down\')" src="https://qnphoto.kagirl.cn/icon/snajiao.png">\
				</div>';
            obj.appendChild(div);
        }

        obj.style.overflow = 'auto';

        var parent = document.getElementById("e-content-3");
        parent.style.overflow = 'auto';

        objid("e-menu").style.display = "none";
    }


    function e_move_pic(index, photoid, action)
    {
        var content = objid("e-pics-content");
        var offset = 0;
        for(var i = offset;i<content.children.length;i++)
        {
            if(content.children[i].id == "e-del-pic-" + index)
            {
                if((i == offset && action == "up") || (i == content.children.length - 1 && action == "down"))
                {
                    return;
                }
                else
                {
                    var obj = objid("e-del-pic-" + index);
                    if(action == "up")
                    {
                        var nextObj = content.children[i-1];
                        // obj.style.webkitAnimation = "up-pic 0.5s";
                        // nextObj.style.webkitAnimation = "down-pic 0.5s";
                        // setTimeout(function(){
                        // 	obj.style.webkitAnimation = "";
                        // 	nextObj.style.webkitAnimation = "";
                        content.insertBefore(obj, nextObj);
                        // }, 500);
                    }
                    else
                    {
                        var nextObj = content.children[i+1];
                        // obj.style.webkitAnimation = "down-pic 0.5s";
                        // nextObj.style.webkitAnimation = "up-pic 0.5s";
                        // setTimeout(function(){
                        // 	obj.style.webkitAnimation = "";
                        // 	nextObj.style.webkitAnimation = "";
                        content.insertBefore(nextObj, obj);
                        // }, 500);
                    }
                    break;
                }
            }
        }

        for(var i = 0; i<slider_images_url.length;i++)
        {
            if(get_pid(slider_images_url[i]) == photoid)
            {
                if((i == 0 && action == "up") || (i == slider_images_url - 1 && action == "down"))
                {
                    return;
                }
                else
                {
                    var j = action == "up" ? i-1 : i+1;
                    var temp = slider_images_url[j];
                    slider_images_url[j] = slider_images_url[i];
                    slider_images_url[i] = temp;
                    break;
                }
            }
        }

        var url = "editbook.php?";
        url = url + 'type=move_photo';
        url = url + "&bookid=" + e_bookid;
        url = url + "&openid=" + e_openid;
        url = url + "&wxid=" + wxid;
        url = url + "&action=" + action;
        url = url + "&photoid=" + photoid;

        XMLHttp.sendReq('GET', url, '', function(ret){});
    }

    function syncupload(index, localIds)
    {
        if(index >= localIds.length)
        {
            setTimeout(function(){
                e_close_wind();
                e_pics(3);
                var obj = objid("e-pics-content");
                obj.scrollTop = obj.scrollHeight - obj.clientHeight;
                document.body.removeChild(objid("uploadprocess"));
            }, 2000);
            return;
        }
        var localId = localIds[index];
        wx.uploadImage({
            localId: localId, // 需要上传的图片的本地ID，由chooseImage接口获得
            isShowProgressTips: 0, // 默认为1，显示进度提示
            success: function (res) {
                var serverId = res.serverId; // 返回图片的服务器端ID

                var url = "editbook.php?";
                url = url + 'type=fetch_photo';
                url = url + "&bookid=" + e_bookid;
                url = url + "&openid=" + e_openid;
                url = url + "&wxid=" + wxid;
                url = url + "&serverid=" + serverId;
                url = url + "&atkname=" + atkname;

                XMLHttp.sendReq('GET', url, '', function(ret){
                    var obj = JSON.parse(ret.responseText);
                    slider_images_url.push(obj["url"]);

                    objid("uploadstate").innerHTML = (index + 1) + "/" + localIds.length + "上传中";
                    syncupload(index + 1, localIds);
                });
            }
        });
    }

    function e_add_pic()
    {
        if(upload_permission == true)
        {
            wx.chooseImage({
                count: 9, // 默认9
                sizeType: ['compressed'], // 可以指定是原图还是压缩图，默认二者都有
                sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                success: function (res) {
                    var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片

                    var div = document.createElement('div');
                    div.id = "uploadprocess";
                    div.style.cssText = 'position: absolute;width: 100%;height: 100%;z-index: 11000;';
                    div.innerHTML = '<div style="position: absolute;width: 100%;height: 100%;z-index: 0;background-color: black;opacity: 0.5;"></div>\
  <div style="position: absolute;top: 40%;width: 300px;left: 100px;height: 100px;border-radius: 10px;overflow: hidden;">\
  <div style="position: absolute;width: 100%;height: 100%;z-index: 0;background-color: black;opacity: 0.68;"></div>\
  <img src="https://qnphoto.kagirl.cn/icon/load.png" style="position: absolute;z-index: 1;top: 15px;left: 16px; -webkit-animation: zhuan 1s linear infinite;"><span id="uploadstate" style="position: absolute;line-height: 70px;top: 15px;left: 102px;z-index: 1;color: white;font-size: 22px;">0/'+localIds.length+'上传中</span></div>';

                    document.body.appendChild(div);

                    syncupload(0, localIds);
                }
            });
        }
        else
        {
            XMLHttp.sendReq('GET', 'adpv.php?click=10', '', function(){
            });

            objid('e-addpic-tip').style.display = 'block';
        }
    }

    function e_addpic_ok()
    {
        var url = "editbook.php?";
        url = url + 'type=add_photo';
        url = url + "&bookid=" + e_bookid;
        url = url + "&openid=" + e_openid;
        url = url + "&wxid=" + wxid;

        XMLHttp.sendReq('GET', url, '', function(){
            wx.closeWindow();
        });

    }

    function e_addpic_cancle()
    {
        objid('e-addpic-tip').style.display = 'none';
    }

    function e_del_pic(index, photo_id)
    {
        if(!confirm('确定要删除该照片吗？'))
        {
            return;
        }

        try{
            var obj = objid('e-pics-content');
            obj.removeChild(objid('e-del-pic-' + index));
        }catch(e){}
        try{
            var obj = objid('e-bigpics-content');
            obj.removeChild(objid('e-del-bigpic-' + index));
        }catch(e){}

        var new_pics = [];

        for(var i in slider_images_url)
        {
            if(get_pid(slider_images_url[i]) != photo_id)
            {
                new_pics.push(slider_images_url[i])
            }
        }

        slider_images_url = new_pics;

        on_weixin_share();

        //reset_scene();

        var url = "editbook.php?";
        url	= url + 'type=delete_photo';
        url	= url + "&bookid=" + e_bookid;
        url	= url + "&photoid=" + photo_id;
        url	= url + "&openid=" + e_openid;
        url = url + "&wxid=" + wxid;

        //location.href = url;
        XMLHttp.sendReq('GET', url, '', function(){});
    }

    var get_pid = function(url){
        var index1 = url.indexOf("?");
        if(index1 != -1)
        {
            url = url.substr(0, index1);
        }
        return url.toString().substr(url.lastIndexOf("/") + 1);
    }

    //标题
    function e_words(index)
    {
        // e_close_wind();
        // e_open_wind(index);
        // if(e_desc=='音乐相册，打开看看')
        // 	objid('e-share-words').value = '';
        // else
        // 	objid('e-share-words').value = e_desc;

        e_close_wind();
        e_open_wind(index);
        init_height();

        objid("e-menu").style.display = "none";

        var obj = objid('e-bigpics-content');

        var w = e_desc == "我的相册，打开看看" || e_desc == "" ? "" : e_desc;

        obj.innerHTML = '<div><textarea id="e-share-words" maxlength="30" rows="4" placeholder="点击这里写标题（限30字，默认为：我的相册，打开看看）">'+w+'</textarea></div>\
						<div class="words-tip"></div>';
        e_position = [];

        e_pics_index = 0;

        for(var i = 0; i<slider_images_url.length && i<9;i++)
        {
            pic_showone(i, obj);
        }
        e_pics_index = i;

        obj.style.overflow = 'auto';

        var parent = document.getElementById("e-content-4");
        parent.style.overflow = 'auto';
        // objid("e-wind-close").onclick = e_pics_complete;
    }

    function bigpic_scroll()
    {
        var obj = objid("e-bigpics-content");
        if(obj.scrollTop + obj.clientHeight + 20 >= obj.scrollHeight && e_pics_index < slider_images_url.length)
        {

            for(var i = e_pics_index; i<slider_images_url.length && i< e_pics_index + 9;i++)
            {
                pic_showone(i, obj);
            }
            e_pics_index = i;
        }
        event.preventDefault();
    }


    function pic_showone(index, content)
    {
        var photo_id  = get_pid(slider_images_url[index]);

        var div = document.createElement('div');
        div.id  = 'e-del-bigpic-' + index;
        div.setAttribute('class','e-del-bigitem');

        var word = words[photo_id] ? words[photo_id] : "";

        var htm = "<div class='e-del-bigpic' style='background-image:url(" + slider_images_url[index] + ")'></div>";
        htm += "<textarea class='editwords' id='editwords-"+photo_id+"' placeholder='点击这里给照片添加文字（限16字，可选）' maxlength=16>" + word + "</textarea>";
        htm += '<div class="e-del-bigup" onclick="e_move_bigpic('+index+', \'' + photo_id + '\', \'up\')"><img src="https://qnphoto.kagirl.cn/icon/posup.png"/></div>';
        htm += '<div class="e-del-bigdown" onclick="e_move_bigpic('+index+', \'' + photo_id + '\', \'down\')"><img src="https://qnphoto.kagirl.cn/icon/posdown.png"/></div>';
        htm += '<div class="e-del-bigok" onclick="e_del_pic('+index+', \'' + photo_id + '\')"><img src="https://qnphoto.kagirl.cn/icon/delpic.png"/></div>';

        div.innerHTML = htm;
        content.appendChild(div);
    }

    function e_pics_complete()
    {
        // objid("e-wind-close").onclick = reflush;
        var title = objid('e-share-words').value;
        if(title == "点击这里写标题(限30字)...")
        {
            title = "";
        }
        title = title.replace("\\", "");
        title = title.substr(0, 30);

        for(var i = 0;i<slider_images_url.length;i++)
        {
            var pid = get_pid(slider_images_url[i]);
            var obj = objid("editwords-" + pid);
            if(obj)
            {
                var txt = obj.value;
                txt = txt.replace("\\", "");
                txt = txt.replace("\n", "。");
                txt = txt.replace("\"", "'");
                txt = txt.substr(0, 16);
                words[pid] = txt;
            }
        }

        var url = "editbook.php?";
        url	= url + 'type=add_word';
        url	= url + "&openid=" + e_openid;
        url	= url + "&bookid=" + e_bookid;
        url = url + "&wxid=" + wxid;
        url = url + "&title=" + title;

        XMLHttp.sendReq("post", url, "data=" + encodeURIComponent(JSON.stringify(words)), function(ret){
            var obj = JSON.parse(ret.responseText);
            if(obj["errmsg"])
            {
                alert(obj["errmsg"]);

            }
            else
            {
                var value = objid('e-share-words').value;
                if(value != "")
                {
                    e_desc = value
                }
                on_weixin_share();
                document.title = e_desc;
                reflush();
            }
        });

        // reflush();
    }

    function e_move_bigpic(index, photoid, action)
    {
        var content = objid("e-bigpics-content");
        var offset = 2;
        for(var i = offset;i<content.children.length;i++)
        {
            if(content.children[i].id == "e-del-bigpic-" + index)
            {
                if((i == offset && action == "up") || (i == content.children.length - 1 && action == "down"))
                {
                    return;
                }
                else
                {
                    var obj = objid("e-del-bigpic-" + index);
                    if(action == "up")
                    {
                        var nextObj = content.children[i-1];
                        obj.style.webkitAnimation = "up-pic 0.5s";
                        nextObj.style.webkitAnimation = "down-pic 0.5s";
                        setTimeout(function(){
                            obj.style.webkitAnimation = "";
                            nextObj.style.webkitAnimation = "";
                            content.insertBefore(obj, nextObj);
                        }, 500);
                    }
                    else
                    {
                        var nextObj = content.children[i+1];
                        obj.style.webkitAnimation = "down-pic 0.5s";
                        nextObj.style.webkitAnimation = "up-pic 0.5s";
                        setTimeout(function(){
                            obj.style.webkitAnimation = "";
                            nextObj.style.webkitAnimation = "";
                            content.insertBefore(nextObj, obj);
                        }, 500);
                    }
                    break;
                }
            }
        }

        for(var i = 0; i<slider_images_url.length;i++)
        {
            if(get_pid(slider_images_url[i]) == photoid)
            {
                if((i == 0 && action == "up") || (i == slider_images_url - 1 && action == "down"))
                {
                    return;
                }
                else
                {
                    var j = action == "up" ? i-1 : i+1;
                    var temp = slider_images_url[j];
                    slider_images_url[j] = slider_images_url[i];
                    slider_images_url[i] = temp;
                    break;
                }
            }
        }

        var url = "editbook.php?";
        url = url + 'type=move_photo';
        url = url + "&bookid=" + e_bookid;
        url = url + "&openid=" + e_openid;
        url = url + "&wxid=" + wxid;
        url = url + "&action=" + action;
        url = url + "&photoid=" + photoid;

        XMLHttp.sendReq('GET', url, '', function(ret){});
    }

    function e_set_desc()
    {
        var obj = objid('e-share-words');
        if(obj.value == "")
        {
            alert('文字不能为空噢~');
        }
        else
        {
            var url = "editbook.php?";
            url = url + 'type=set_desc';
            url = url + "&bookid=" + e_bookid;
            url = url + "&openid=" + e_openid;
            url = url + "&desc=" + encodeURIComponent(obj.value);
            url = url + "&wxid=" + wxid;

            XMLHttp.sendReq('GET', url, '', function(ret){
                var obj = JSON.parse(ret.responseText);
                if(obj["errmsg"])
                {
                    alert(obj["errmsg"]);
                }
                else
                {

                    e_desc = objid('e-share-words').value;
                    on_weixin_share();
                    document.title = e_desc;
                    reflush();
                }
            });
        }
        //e_close_wind();
    }

    function e_template_type(type)
    {
        var template_box = objid('e-template-box');

        var template_arr = {
            'xinqing':['faya','jiniance','qingchun','bingxue','lonely','qingxin','lianhua','qianlv','baokan','moshang','green','xiantiao','meishi','xinfeng','huazhou','biyeji','yuedu','yixia','tongxue','naxienian','xingxing','gray','qiufeng','lvxing','flowers','autumn','yumao'],
            'aiqing':['qingren','lovetrip','qixi','love','fengche','nvren','wuwangwo','xiangyin','xingfu','dahua','quanping'],
            'fengjing':['qingchun','jiniance','moshang','qingxin','bingxue','xinfeng','meishi','biyeji','naxienian','summer','shatan'],
            'jieri':['xinnian2','xinchun','yuanxiao','xinnian','fulushou','zhongqiu1','huijia','guoqing','shengdan','shengdan1','shengdan2','zhongqiu','duanwu','shengri','birthday','junhun','junhun1','qian','teacher','moon','shiyi','chongyang'],
            'ertong':['baby','heimao','minion','morning','maode','xiaozhen','baokan','qiqiu','wuyijie','ertongjie','maxituan','nanfeng','yelu'],
            '3d':['cubeover','hualuo','faya','yixia','green','huijia','xuandong','flip','brick','roll','bubble','paopao','jingjing','tongxue','balloon','zazhi','rose']};

        var all_templates = document.getElementsByClassName('e-template-item')
        for(var i =0;i<all_templates.length;i++)
        {
            all_templates[i].style.display = 'none';
        }
        if(type == '3d'|| type == 'aiqing' || type == 'jieri' || type == 'xinqing' || type == 'ertong' || type == 'fengjing')
        {
            for (var i =0;i<template_arr[type].length;i++)
            {
                objid('template-'+template_arr[type][i]).style.display = 'block';
            }

            for(key in template_arr)
            {
                objid('e-template-type-'+key).style.color = 'rgb(214,66,90)';
            }
            objid('e-template-type-hot').style.color = 'rgb(214,66,90)';
            objid('e-template-type-'+type).style.color = '#fff';
        }
        else
        {
            for(var i =0;i<all_templates.length;i++)
            {
                all_templates[i].style.display = 'block';
            }

            for(key in template_arr)
            {
                objid('e-template-type-'+key).style.color = 'rgb(214,66,90)';
            }
            objid('e-template-type-hot').style.color = '#fff';
        }
        e_template_scroll();
    }

    function reset_music ()
    {
        var url = 'musicreset.php?scene=';
        url = url + e_scene;

        XMLHttp.sendReq('GET',url,'',function(obj){
            var music = JSON.parse(obj.responseText);
            e_music_title_click(music['url'],1)
            e_music_select(music['name'])
            // objid('e-player').src = music_url;
            // e_music_select(music_url);
        })
    }

    function init_height()
    {
        var height = objid("e-menu").offsetTop + 64;
        if(height > 100)
        {
            objid("e-template-box").style.height = (height-191) + "px";
            objid("e-mp3box").style.height = (height-191) + "px";
            objid("e-bigpics-content").style.height = (height - 142) + "px";
            objid("e-pics-content").style.height = (height - 142) + "px";
            objid("e-addpic-btn").style.top = (height - 142 + 76) + "px";
        }
    }

    function e_saveoffline()
    {
        location.href = "saveoffstat.php?type=editbook&bookid=" + e_bookid + "&wxid=" + wxid;
    }

    call_me(init_height);
    call_me(function(){
//        try{
//
//            if(tbssaveoff)
//            {
//                var parent = objid("e-menu");
//                for(var i=0;i<parent.children.length;i++)
//                {
//                    parent.children[i].style.width = "90px";
//                    parent.children[i].style.fontSize = "14pt";
//                    parent.children[i].style.marginLeft = "10px";
//                }
//                var offdiv = document.createElement("div");
//                offdiv.innerHTML = '<div>离线保存</div><div class="e-opacity-back"></div>';
//                offdiv.className = "e-menu-item";
//                offdiv.setAttribute("onclick", "e_saveoffline()");
//                offdiv.style.cssText = "width:90px;font-size:14pt;margin-left:10px;";
//                parent.appendChild(offdiv);
//
//                if(editmode)
//                    XMLHttp.sendReq('GET', 'adpv.php?click=saveshow', '', function(){});
//            }
//            else
//            {
//                if(editmode)
//                    XMLHttp.sendReq('GET', 'adpv.php?click=nosaveshow', '', function(){});
//            }
//        }catch(e){
//        }
    });
</script>

